var ms=Object.defineProperty;var ds=(e,s,a)=>s in e?ms(e,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[s]=a;var G=(e,s,a)=>ds(e,typeof s!="symbol"?s+"":s,a);import{d as D,u as vs,o as S,c as F,F as k,r as V,a as E,n as U,t as I,b as M,e as K,_ as x,f as _,p as Ve,m as fs,g as hs,h as ys,i as ps,j as Ss,k as ws,l as gs,q as As,s as Fs,v as Be,w as qs,x as bs,y as Cs,z as _s,A as Es,B as Ns,C as Os,D as Is,E as Ms,G as xe,H as b,I as Ts,J as Rs,K as Ps,L as Ls,M as $s,N as ue,O as ks,P as Z,V as Le,Q as R,R as N,S as P,T as J,U as ne,W as de,X as B,Y as ae,Z as Ce,$ as ve,a0 as Ue,a1 as $e,a2 as Ds,a3 as Gs,a4 as Vs,a5 as Bs,a6 as xs,a7 as je,a8 as ze}from"./index-6jDwWphW.js";import{c as z}from"./_commonjsHelpers-Cpj98o6Y.js";const Y=class Y{};G(Y,"IsOnRange",(s,a,i)=>i<a&&i>s),G(Y,"Clamp",(s,a=0,i=1)=>Math.min(i,Math.max(a,s))),G(Y,"Lerp",(s,a,i)=>s*(1-i)+a*i),G(Y,"Invlerp",(s,a,i)=>Y.Clamp((i-s)/(a-s))),G(Y,"ToRange",(s,a,i,l=0,o=1)=>Y.Lerp(l,o,Y.Invlerp(a,i,s)));let j=Y;class C{constructor(s,a,i){G(this,"$natural",!0);G(this,"name",{classic:C.Classic.ENotes.NONE,american:C.American.ENotes.NONE});G(this,"frequency",{main:0,min:0,max:0});G(this,"isNatural",()=>this.$natural);this.frequency.main=s,a&&(this.name.classic=a),i&&(this.name.american=i)}}class H extends C{constructor(a,i=C.Classic.ENotes.NONE,l=C.American.ENotes.NONE){super(a,i,l);G(this,"sharp",C.EmptyNote);G(this,"flat",C.EmptyNote);this.$natural=!1}}(e=>{(o=>{o[o.CLASSIC=0]="CLASSIC",o[o.AMERICAN=1]="AMERICAN"})(e.Systems||(e.Systems={})),(o=>{o[o.SHARP=0]="SHARP",o[o.FLAT=1]="FLAT",o[o.NATURAL=2]="NATURAL",o[o.DOUBLE_SHARP=3]="DOUBLE_SHARP",o[o.DOUBLE_FLAT=4]="DOUBLE_FLAT"})(e.Accidentals||(e.Accidentals={})),(o=>{(t=>{t.NONE="?",t.DO="DO",t.DOS_REF="DO# REb",t.RE="RE",t.RES_MIF="RE# MIb",t.MI="MI",t.FA="FA",t.FAS_SOLF="FA# SOLb",t.SOL="SOL",t.SOLS_LAF="SOL# LAb",t.LA="LA",t.LAS_SIF="LA# SIb",t.SI="SI"})(o.ENotes||(o.ENotes={}))})(e.Classic||(e.Classic={})),(o=>{(t=>{t.NONE="?",t.C="C",t.CS_DF="C# Db",t.D="D",t.DS_EF="D# Eb",t.E="E",t.F="F",t.FS_GF="F# Gb",t.G="G",t.GS_AF="G# Ab",t.A="A",t.AS_BF="A# Bb",t.B="B"})(o.ENotes||(o.ENotes={}))})(e.American||(e.American={}));let s=[new e(261.63,"DO","C"),new H(277.18,"DO# REb","C# Db"),new e(293.66,"RE","D"),new H(311.13,"RE# MIb","D# Eb"),new e(329.63,"MI","E"),new e(349.23,"FA","F"),new H(369.99,"FA# SOLb","F# Gb"),new e(392,"SOL","G"),new H(415.3,"SOL# LAb","G# Ab"),new e(440,"LA","A"),new H(466.16,"LA# SIb","A# Bb"),new e(493.88,"SI","B")];e.Notes=s,e.EmptyNote=new H(0);let a=[],i=[];const l=(o,t)=>Math.sqrt(o*t);e.FillMedFrequencys=(o,t,r)=>{for(let n=0;n<o.length;n++){{const c=n>0?o[n-1].frequency.main:o[o.length-1].frequency.main/2;o[n].frequency.min=l(c,o[n].frequency.main)}{const c=n<o.length-1?o[n+1].frequency.main:o[0].frequency.main*2;o[n].frequency.max=l(o[n].frequency.main,c)}o[n]instanceof H?(o[n].sharp=o[n-1],o[n].flat=o[n+1],r.push(o[n])):(t.push(o[n]),n<o.length-1&&!(o[n+1]instanceof H)&&r.push(e.EmptyNote))}},(0,e.FillMedFrequencys)(s,a,i),e.Naturals=a,e.Semis=i})(C||(C={}));var T;(e=>{e.OCTAVE_CENTRAL=4,e.OCTAVE_RANGE={MIN:1,MAX:7};const s=(n,c)=>n/Math.pow(2,c),a=(n,c)=>n*Math.pow(2,c),i=(n,c)=>n==e.OCTAVE_CENTRAL?c:n<e.OCTAVE_CENTRAL?s(c,e.OCTAVE_CENTRAL-n):a(c,n-e.OCTAVE_CENTRAL);let l=[],o=[],t=[];for(let n=e.OCTAVE_RANGE.MIN;n<=e.OCTAVE_RANGE.MAX;n++){let c=[],y=[],h=[];C.Notes.forEach(v=>{const u=i(n,v.frequency.main);let d;v instanceof H?d=new H(u,v.name.classic,v.name.american):d=new C(u,v.name.classic,v.name.american),c.push(d)}),C.FillMedFrequencys(c,y,h),l.push(c),o.push(y),t.push(h)}const r=n=>j.Clamp(n,e.OCTAVE_RANGE.MIN,e.OCTAVE_RANGE.MAX)-e.OCTAVE_RANGE.MIN;e.GetNotesAtOctave=n=>l[r(n)],e.GetNaturalsAtOctave=n=>o[r(n)],e.GetSemisAtOctave=n=>t[r(n)],e.GetNoteAtOctave=(n,c)=>(0,e.GetNotesAtOctave)(n)[c],e.INVALID_OCTAVE=-1,e.GetNoteFromFrequency=n=>{const h=Math.round(12*(Math.log(n/440)/Math.log(2)))+69,v=h%12,u=Math.floor(h/12)-1;return j.IsOnRange(e.OCTAVE_RANGE.MIN,e.OCTAVE_RANGE.MAX,u)?{note:e.GetNoteAtOctave(u,v),octave:u,indexNote:v}:{note:C.EmptyNote,octave:e.INVALID_OCTAVE,indexNote:-1}}})(T||(T={}));const Us=(e,s,a)=>{let i=parseInt(e,16)&255,l=parseInt(s,16)&255;return Math.round(i+(l-i)*a).toString(16).padStart(2,"0")},js=(e,s,a)=>{let i=parseInt(e.slice(1),16),l=parseInt(s.slice(1),16),o=i>>16&255,t=i>>8&255,r=i&255,n=l>>16&255,c=l>>8&255,y=l&255,h=Math.round(o+(n-o)*a),v=Math.round(t+(c-t)*a),u=Math.round(r+(y-r)*a);return`#${(h<<16|v<<8|u).toString(16).padStart(6,"0")}`},zs=D({__name:"TunerDigitalNeedle",props:{frequency:{},noteFreq:{default:()=>C.EmptyNote.frequency},size:{},top:{},left:{},showNumbers:{type:Boolean}},setup(e){const s=vs(),a=l=>{l-=50,l=Math.abs(l);const o=s.global.current.value.colors.primary,t=s.global.current.value.colors["on-background"],r=s.global.current.value.colors["on-surface"];let n,c="ff";if(l<=10)n=o;else{const y=(l-10)/40;n=js(r,t,y),c=Us("ff","40",y)}return n+c},i=()=>j.ToRange(e.frequency,e.noteFreq.min,e.noteFreq.max,-90,90);return(l,o)=>(S(),F("div",{class:"back-circle",style:U(`width:${l.size??24}em; height:${l.size??24}em; top:${l.top??1}em; left:${l.left??0}em`)},[(S(),F(k,null,V(101,(t,r)=>E("div",{class:"line-cont",style:U(`transform: rotateZ(${-90+r*1.8}deg);`)},[l.showNumbers&&r%10==0?(S(),F("span",{key:0,class:"num",style:U("color:"+a(r))},I(r-50),5)):M("",!0),E("span",{class:K(`line ${r%10==0?"big":r%5==0?"half":"small"}`),style:U("background-color:"+a(r))},null,6)],4)),64)),E("div",{class:"line-cont",style:U(`transform: rotateZ(${i()}deg)`)},o[0]||(o[0]=[E("span",{class:"line needle"},null,-1)]),4)],4))}}),He=x(zs,[["__scopeId","data-v-0647af02"]]);var ee={},Ee={},fe=z&&z.__assign||function(){return fe=Object.assign||function(e){for(var s,a=1,i=arguments.length;a<i;a++){s=arguments[a];for(var l in s)Object.prototype.hasOwnProperty.call(s,l)&&(e[l]=s[l])}return e},fe.apply(this,arguments)};Object.defineProperty(Ee,"__esModule",{value:!0});var Hs={threshold:.1,sampleRate:44100,probabilityThreshold:.1};function Ws(e){e===void 0&&(e={});var s=fe(fe({},Hs),e),a=s.threshold,i=s.sampleRate,l=s.probabilityThreshold;return function(t){var r;for(r=1;r<t.length;r*=2);r/=2;for(var n=r/2,c=new Float32Array(n),y=0,h,v=0;v<n;v++)c[v]=0;for(var v=1;v<n;v++)for(var u=0;u<n;u++){var d=t[u]-t[u+v];c[v]+=d*d}c[0]=1,c[1]=1;for(var g=0,v=1;v<n;v++)g+=c[v],c[v]*=v/g;for(h=2;h<n;h++)if(c[h]<a){for(;h+1<n&&c[h+1]<c[h];)h++;y=1-c[h];break}if(h===n||c[h]>=a||y<l)return null;var f,m,p;if(h<1?m=h:m=h-1,h+1<n?p=h+1:p=h,m===h)c[h]<=c[p]?f=h:f=p;else if(p===h)c[h]<=c[m]?f=h:f=m;else{var w=c[m],A=c[h],q=c[p];f=h+(q-w)/(2*(2*A-q-w))}return i/f}}Ee.YIN=Ws;var Ne={},he=z&&z.__assign||function(){return he=Object.assign||function(e){for(var s,a=1,i=arguments.length;a<i;a++){s=arguments[a];for(var l in s)Object.prototype.hasOwnProperty.call(s,l)&&(e[l]=s[l])}return e},he.apply(this,arguments)};Object.defineProperty(Ne,"__esModule",{value:!0});var Ys={sampleRate:44100,minFrequency:82,maxFrequency:1e3,ratio:5,sensitivity:.1};function Ks(e){e===void 0&&(e={});var s=he(he({},Ys),e),a=s.sampleRate,i=s.minFrequency,l=s.maxFrequency,o=s.sensitivity,t=s.ratio,r=[],n=Math.ceil(a/i),c=Math.floor(a/l);return function(h){var v=h.length,u=0,d=1/0,g=-1/0,f,m,p,w,A,q,O,L;for(w=0;w<v;w++)if(c<=w&&w<=n){for(O=0,L=w,u=0,f=[],m=[];O<v-w;u++,L++,O++)f[u]=h[O],m[u]=h[L];var W=f.length;for(p=[],q=0;q<W;q++)p[q]=f[q]-m[q];var se=0;for(q=0;q<W;q++)se+=Math.abs(p[q]);r[w]=se}for(A=c;A<n;A++)r[A]<d&&(d=r[A]),r[A]>g&&(g=r[A]);var Q=Math.round(o*(g-d)+d);for(A=c;A<=n&&r[A]>Q;A++);var le=c/2;d=r[A];var X=A;for(w=A-1;w<A+le&&w<=n;w++)r[w]<d&&(d=r[w],X=w);return Math.round(r[X]*t)<g?a/X:null}}Ne.AMDF=Ks;var Oe={},ye=z&&z.__assign||function(){return ye=Object.assign||function(e){for(var s,a=1,i=arguments.length;a<i;a++){s=arguments[a];for(var l in s)Object.prototype.hasOwnProperty.call(s,l)&&(e[l]=s[l])}return e},ye.apply(this,arguments)};Object.defineProperty(Oe,"__esModule",{value:!0});var ke={sampleRate:44100};function Xs(e){e===void 0&&(e=ke);var s=ye(ye({},ke),e),a=s.sampleRate;return function(l){var o=l.length,t=0,r,n,c,y;for(r=0;r<o;r++)y=l[r],t+=y*y;if(t=Math.sqrt(t/o),t<.01)return-1;var h=0,v=o-1,u=.2;for(r=0;r<o/2;r++)if(Math.abs(l[r])<u){h=r;break}for(r=1;r<o/2;r++)if(Math.abs(l[o-r])<u){v=o-r;break}var d=l.slice(h,v),g=d.length,f=new Array(g).fill(0);for(r=0;r<g;r++)for(n=0;n<g-r;n++)f[r]=f[r]+d[n]*d[n+r];for(c=0;f[c]>f[c+1];)c++;var m=-1,p=-1;for(r=c;r<g;r++)f[r]>m&&(m=f[r],p=r);var w=p,A=f[w-1],q=f[w],O=f[w+1],L=(A+O-2*q)/2,W=(O-A)/2;return L&&(w=w-W/(2*L)),a/w}}Oe.ACF2PLUS=Xs;var Ie={},pe=z&&z.__assign||function(){return pe=Object.assign||function(e){for(var s,a=1,i=arguments.length;a<i;a++){s=arguments[a];for(var l in s)Object.prototype.hasOwnProperty.call(s,l)&&(e[l]=s[l])}return e},pe.apply(this,arguments)};Object.defineProperty(Ie,"__esModule",{value:!0});var Js=6,Qs=3e3,Zs=3,et=.75,st={sampleRate:44100};function tt(e){e===void 0&&(e={});var s=pe(pe({},st),e),a=s.sampleRate;return function(l){for(var o=[],t=[],r=l.length,n=null,c=0,y=0,h=0,v=0;v<r;v++){var u=l[v];c=c+u,h=Math.max(h,u),y=Math.min(y,u)}c/=r,y-=c,h-=c;for(var d=h>-1*y?h:-1*y,g=d*et,f=0,m=-1,p=l.length,w,A,q;w=~~(a/(Math.pow(2,f)*Qs)),!(p<2);){var O=void 0,L=-1e3,W=-1e6,se=-1e6,Q=!1,le=!1;q=0,A=0;for(var v=2;v<p;v++){var X=l[v]-c,Ae=l[v-1]-c;Ae<=0&&X>0&&(Q=!0),Ae>=0&&X<0&&(le=!0),O=X-Ae,L>-1e3&&(le&&L<0&&O>=0&&Math.abs(X)>=g&&v>W+w&&(o[q++]=v,W=v,le=!1),Q&&L>0&&O<=0&&Math.abs(X)>=g&&v>se+w&&(t[A++]=v,se=v,Q=!1)),L=O}if(q===0&&A===0)break;for(var Re=void 0,ie=[],v=0;v<p;v++)ie[v]=0;for(var v=0;v<q;v++)for(var $=1;$<Zs;$++)v+$<q&&(Re=Math.abs(o[v]-o[v+$]),ie[Re]+=1);for(var te=-1,Fe=-1,v=0;v<p;v++){for(var ce=0,$=-1*w;$<=w;$++)v+$>=0&&v+$<p&&(ce+=ie[v+$]);ce===Fe?v===2*te&&(te=v):ce>Fe&&(Fe=ce,te=v)}for(var me=0,Pe=0,$=-w;$<=w;$++)if(te+$>=0&&te+$<r){var qe=ie[te+$];qe>0&&(Pe+=qe,me+=(te+$)*qe)}if(me/=Pe,m>-1&&Math.abs(me*2-m)<=2*w){n=a/(Math.pow(2,f-1)*m);break}if(m=me,f++,f>=Js||p<2)break;var be=l.subarray(0);p===ie.length&&(be=new Float32Array(p/2));for(var v=0;v<p/2;v++)be[v]=(l[2*v]+l[2*v+1])/2;l=be,p/=2}return n}}Ie.DynamicWavelet=tt;var Me={},Se=z&&z.__assign||function(){return Se=Object.assign||function(e){for(var s,a=1,i=arguments.length;a<i;a++){s=arguments[a];for(var l in s)Object.prototype.hasOwnProperty.call(s,l)&&(e[l]=s[l])}return e},Se.apply(this,arguments)};Object.defineProperty(Me,"__esModule",{value:!0});var at={bufferSize:1024,cutoff:.97,sampleRate:44100};function nt(e){e===void 0&&(e={});var s=Se(Se({},at),e),a=s.bufferSize,i=s.cutoff,l=s.sampleRate,o=.5,t=80,r=new Float32Array(a),n=new Float32Array(a),c,y,h=[],v=[],u=[];function d(m){var p,w;n[0]=m[0]*m[0];for(var A=1;A<m.length;A+=1)n[A]=m[A]*m[A]+n[A-1];for(var q=0;q<m.length;q++){p=0,w=n[m.length-1-q]+n[m.length-1]-n[q];for(var A=0;A<m.length-q;A++)p+=m[A]*m[A+q];r[q]=2*p/w}}function g(m){var p=r[m-1],w=r[m],A=r[m+1],q=m,O=A+p-2*w;if(O===0)c=q,y=w;else{var L=p-A;c=q+L/(2*O),y=w-L*L/(8*O)}}function f(){for(var m=0,p=0;m<(r.length-1)/3&&r[m]>0;)m++;for(;m<r.length-1&&r[m]<=0;)m++;for(m==0&&(m=1);m<r.length-1;)if(r[m]>r[m-1]&&r[m]>=r[m+1]&&(p==0||r[m]>r[p])&&(p=m),m++,m<r.length-1&&r[m]<=0)for(p>0&&(h.push(p),p=0);m<r.length-1&&r[m]<=0;)m++;p>0&&h.push(p)}return function(p){var w;h=[],v=[],u=[],d(p),f();for(var A=-1/0,q=0;q<h.length;q++){var O=h[q];A=Math.max(A,r[O]),r[O]>o&&(g(O),u.push(y),v.push(c),A=Math.max(A,y))}if(v.length){for(var L=i*A,W=0,q=0;q<u.length;q++)if(u[q]>=L){W=q;break}var se=v[W],Q=l/se;Q>t?w=Q:w=-1}else w=-1;return{probability:A,freq:w}}}Me.Macleod=nt;var We={};(function(e){var s=z&&z.__assign||function(){return s=Object.assign||function(l){for(var o,t=1,r=arguments.length;t<r;t++){o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(l[n]=o[n])}return l},s.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.DEFAULT_FREQUENCIES_PARAMS={tempo:120,quantization:4,sampleRate:44100};function a(l,o){var t=l.map(function(u){return u(o)}).filter(function(u){return u!==null}).sort(function(u,d){return u-d});if(t.length===1)return t[0];if(t.length===2){var r=t[0],n=t[1];return r*2>n?Math.sqrt(r*n):r}else{var r=t[0],n=t[1],c=t[t.length-2],y=t[t.length-1],h=r*2>n?t:t.slice(1),v=c*2>y?h:h.slice(0,-1);return Math.pow(v.reduce(function(g,f){return g*f},1),1/v.length)}}function i(l,o,t){t===void 0&&(t={});var r=s(s({},e.DEFAULT_FREQUENCIES_PARAMS),t),n=r.tempo,c=r.quantization,y=r.sampleRate,h=o.length,v=Math.round(y*60/(c*n)),u;Array.isArray(l)?u=a.bind(null,l):u=l;for(var d=[],g=0,f=h-v;g<=f;g+=v){var m=o.slice(g,g+v),p=u(m);d.push(p)}return d}e.frequencies=i})(We);Object.defineProperty(ee,"__esModule",{value:!0});var Ye=Ee;ee.YIN=Ye.YIN;var Ke=Ne;ee.AMDF=Ke.AMDF;var Xe=Oe;ee.ACF2PLUS=Xe.ACF2PLUS;var Je=Ie;ee.DynamicWavelet=Je.DynamicWavelet;var Qe=Me;ee.Macleod=Qe.Macleod;var Ze=We;ee.frequencies=Ze.frequencies;var rt=ee.default={YIN:Ye.YIN,AMDF:Ke.AMDF,ACF2PLUS:Xe.ACF2PLUS,DynamicWavelet:Je.DynamicWavelet,Macleod:Qe.Macleod,frequencies:Ze.frequencies};const ot=D({name:"Tuner",emits:["update:frequency","update:note","is-running","update:bad-frequency"],props:{classes:{type:String,default:""},showClassicSystem:{type:Boolean,default:!0},showAmericanSystem:{type:Boolean,default:!0},showSemiSharps:{type:Boolean,defailt:!0},showSemiFlats:{type:Boolean,defailt:!0}},setup(e,{emit:s,expose:a}){const i=_(null),l=_(null),o=_(0),t=_({note:C.EmptyNote,octave:-1,indexNote:-1}),r=_(!1),n=_(!0),c=_(null),y=_(new Date),h=500,v=rt.YIN(),u=w=>{const A=T.GetNoteFromFrequency(w);return A.octave!==T.INVALID_OCTAVE&&(y.value=new Date),A},d=()=>{if(!l.value||!i.value||!r.value)return;const w=l.value.fftSize,A=new Float32Array(w);l.value.getFloatTimeDomainData(A);const q=v(A);if(q){const O=u(q);O.octave==-1?new Date().getTime()-y.value.getTime()>h&&(n.value=!0,s("update:bad-frequency",!0)):(o.value=q,t.value=O,n.value=!1,s("update:note",t.value),s("update:frequency",q),s("update:bad-frequency",!1))}requestAnimationFrame(d)},g=async()=>{if(r.value)return;i.value=new AudioContext,l.value=i.value.createAnalyser(),l.value.fftSize=2048,c.value=await navigator.mediaDevices.getUserMedia({audio:!0}),i.value.createMediaStreamSource(c.value).connect(l.value),r.value=!0,s("is-running",!0),d()},f=()=>{i.value&&i.value.close(),r.value=!1,s("is-running",!1),c.value!=null&&c.value.getTracks().forEach(w=>{w.stop()})},m=w=>w=="?"?w:e.showSemiFlats?e.showSemiSharps?w:w.split(" ")[1]:w.split(" ")[0],p=()=>{const w=j.Invlerp(t.value.note.frequency.min,t.value.note.frequency.max,o.value);return w>.4&&w<.6};return a({startTuner:g,stopTuner:f,getIsOnGoodNote:p}),{frequency:o,note:t,startTuner:g,stopTuner:f,running:r,badFrequency:n,getIsOnGoodNote:p,showSemiNotes:m,TunerDigitalNeedle:He}}}),lt=Ve({color:String,...fs(),...hs(),...ys(),...ps(),...Ss(),...ws(),...gs(),...As(),...Fs()},"VSheet"),we=Be()({name:"VSheet",props:lt(),setup(e,s){let{slots:a}=s;const{themeClasses:i}=qs(e),{backgroundColorClasses:l,backgroundColorStyles:o}=bs(Cs(e,"color")),{borderClasses:t}=_s(e),{dimensionStyles:r}=Es(e),{elevationClasses:n}=Ns(e),{locationStyles:c}=Os(e),{positionClasses:y}=Is(e),{roundedClasses:h}=Ms(e);return xe(()=>b(e.tag,{class:["v-sheet",i.value,l.value,t.value,n.value,y.value,h.value,e.class],style:[o.value,r.value,c.value,e.style]},a)),{}}}),it=Ve({id:String,text:String,...Ts(Rs({closeOnBack:!1,location:"end",locationStrategy:"connected",eager:!0,minWidth:0,offset:10,openOnClick:!1,openOnHover:!0,origin:"auto",scrim:!1,scrollStrategy:"reposition",transition:!1}),["absolute","persistent"])},"VTooltip"),re=Be()({name:"VTooltip",props:it(),emits:{"update:modelValue":e=>!0},setup(e,s){let{slots:a}=s;const i=Ps(e,"modelValue"),{scopeId:l}=Ls(),o=$s(),t=ue(()=>e.id||`v-tooltip-${o}`),r=_(),n=ue(()=>e.location.split(" ").length>1?e.location:e.location+" center"),c=ue(()=>e.origin==="auto"||e.origin==="overlap"||e.origin.split(" ").length>1||e.location.split(" ").length>1?e.origin:e.origin+" center"),y=ue(()=>e.transition?e.transition:i.value?"scale-transition":"fade-transition"),h=ue(()=>Z({"aria-describedby":t.value},e.activatorProps));return xe(()=>{const v=Le.filterProps(e);return b(Le,Z({ref:r,class:["v-tooltip",e.class],style:e.style,id:t.value},v,{modelValue:i.value,"onUpdate:modelValue":u=>i.value=u,transition:y.value,absolute:!0,location:n.value,origin:c.value,persistent:!0,role:"tooltip",activatorProps:h.value,_disableGlobalStack:!0},l),{activator:a.activator,default:function(){var f;for(var u=arguments.length,d=new Array(u),g=0;g<u;g++)d[g]=arguments[g];return((f=a.default)==null?void 0:f.call(a,...d))??e.text}})}),ks({},r)}}),ut={class:"tuner-note text-primary d-flex ga-1"},ct={key:0,class:"tuner-classic tuner-natural"},mt={key:1,class:"tuner-classic tuner-semi"},dt={key:0,class:"tuner-american tuner-natural"},vt={key:1,class:"tuner-american tuner-semi"},ft={class:"tuner-octave"},ht={class:"text-body-1 pt-4 position-relative frequency",style:{width:"8rem"}};function yt(e,s,a,i,l,o){const t=He;return S(),R(we,{class:K(`tuner justify-center ga-4 bg-background align-center mt-4 ${e.classes}`),style:{"z-index":"100"}},{default:N(()=>[e.running?(S(),R(re,{key:1,text:"Detener afinador",location:"start"},{activator:N(({props:r})=>[b(P,Z(r,{icon:"mdi-stop",onClick:e.stopTuner}),null,16,["onClick"])]),_:1})):(S(),R(re,{key:0,text:"Iniciar afinador",location:"start"},{activator:N(({props:r})=>[b(P,Z(r,{icon:"mdi-microphone",onClick:e.startTuner,color:"primary"}),null,16,["onClick"])]),_:1})),E("div",{class:"d-flex justify-center align-center ga-3",style:U(`opacity: ${e.badFrequency?"0.5":"1"}`)},[E("div",ut,[e.showClassicSystem||!e.showAmericanSystem?(S(),F(k,{key:0},[e.note.note.isNatural()?(S(),F("span",ct,I(e.note.note.name.classic),1)):(S(),F("span",mt,I(e.showSemiNotes(e.note.note.name.classic)),1))],64)):M("",!0),e.showAmericanSystem?(S(),F(k,{key:1},[e.note.note.isNatural()?(S(),F("span",dt,I(e.note.note.name.american),1)):(S(),F("span",vt,I(e.showSemiNotes(e.note.note.name.american)),1))],64)):M("",!0),E("span",ft,I(e.note.octave),1)]),E("div",ht,[b(t,{frequency:e.frequency,noteFreq:e.note.note.frequency,size:10,top:-1.5,left:.33},null,8,["frequency","noteFreq"]),E("span",{class:K(`${e.getIsOnGoodNote()?"ok":""}`)},I(e.frequency.toFixed(2))+" Hz ",3)])],4)]),_:1},8,["class"])}const pt=x(ot,[["render",yt],["__scopeId","data-v-88b763e5"]]),St={showClassicSystem:!0,showAmericanSystem:!0},wt={showSemiSharps:!0,showSemiFlats:!0},gt={...St,...wt},At={listenedFrequency:0,badFrequency:!1},Ft={...gt,activeOctaves:[3,4,5],waveform:"sine"},De="MiniTuner:Settings:Instrument",qt=D({__name:"InstrumentSettings",props:{classes:{}},emits:["octaves","show:noteSystems","show:noteSemis","waveform"],setup(e,{emit:s}){const a=s;let i=Ft;const l=f=>{i=f,localStorage.setItem(De,JSON.stringify(i))};(()=>{let f=localStorage.getItem(De);f!=null&&(i=JSON.parse(f))})();const t=()=>{let f=[];return i.showClassicSystem&&f.push(C.Systems.CLASSIC),i.showAmericanSystem&&f.push(C.Systems.AMERICAN),a("show:noteSystems",i.showClassicSystem,i.showAmericanSystem),f},r=()=>{let f=[];return i.showSemiSharps&&f.push(C.Accidentals.SHARP),i.showSemiFlats&&f.push(C.Accidentals.FLAT),a("show:noteSemis",i.showSemiSharps,i.showSemiFlats),f};let n=()=>{};const c=()=>{let f={min:i.activeOctaves[0],max:i.activeOctaves[i.activeOctaves.length-1]};return n(),f};//!-- For save and load from localStorage --
const y=_(c()),h=_(t()),v=_(r()),u=_(i.waveform??"sine");J(h,f=>{const m=f.indexOf(C.Systems.CLASSIC)!=-1,p=f.indexOf(C.Systems.AMERICAN)!=-1;a("show:noteSystems",m,p),l({...i,showClassicSystem:m,showAmericanSystem:p})}),J(v,f=>{const m=f.indexOf(C.Accidentals.SHARP)!=-1,p=f.indexOf(C.Accidentals.FLAT)!=-1;a("show:noteSemis",m,p),l({...i,showSemiSharps:m,showSemiFlats:p})}),J(u,()=>{a("waveform",u.value),l({...i,waveform:u.value})}),n=()=>{const f=y.value.max-y.value.min+1,m=Array.from(Array(f).keys()).map(p=>p+y.value.min);a("octaves",m),l({...i,activeOctaves:m})},n();const d=(f=!0)=>{f?y.value.min-=1:y.value.min+=1,n()},g=(f=!0)=>{f?y.value.max+=1:y.value.max-=1,n()};return(f,m)=>(S(),R(ve,{"no-gutters":"",class:K(`align-center px-3 my-2 position-relative gr-1 ${f.classes}`),style:{"z-index":"20"}},{default:N(()=>[b(ne,{cols:"6",sm:"3",md:"2",class:"d-flex align-center justify-start ga-2 order-1"},{default:N(()=>[b(re,{text:"Incluir una octava grave más",location:"top"},{activator:N(({props:p})=>[b(P,Z(p,{variant:"tonal",disabled:y.value.min<=1,icon:"mdi-music-note-plus",onClick:m[0]||(m[0]=w=>d(!0))}),null,16,["disabled"])]),_:1}),b(re,{text:"Disminuir una octava grave",location:"right"},{activator:N(({props:p})=>[b(P,Z(p,{size:"small",variant:"tonal",disabled:y.value.min>=y.value.max,icon:"mdi-music-note-minus",onClick:m[1]||(m[1]=w=>d(!1))}),null,16,["disabled"])]),_:1})]),_:1}),b(ne,{cols:"12",sm:"12",md:"5",class:"d-flex justify-space-evenly order-3 order-sm-4 order-md-2"},{default:N(()=>[b(de,{multiple:"",modelValue:h.value,"onUpdate:modelValue":m[2]||(m[2]=p=>h.value=p)},{default:N(()=>[b(P,{value:B(C).Systems.CLASSIC},{default:N(()=>m[7]||(m[7]=[ae("Do, Re, ...")])),_:1},8,["value"]),b(P,{value:B(C).Systems.AMERICAN},{default:N(()=>m[8]||(m[8]=[ae("C, D, ...")])),_:1},8,["value"])]),_:1},8,["modelValue"]),b(de,{multiple:"",modelValue:v.value,"onUpdate:modelValue":m[3]||(m[3]=p=>v.value=p)},{default:N(()=>[b(P,{icon:"mdi-music-accidental-sharp",value:B(C).Accidentals.SHARP},null,8,["value"]),b(P,{icon:"mdi-music-accidental-flat",value:B(C).Accidentals.FLAT},null,8,["value"])]),_:1},8,["modelValue"])]),_:1}),b(ne,{cols:"12",sm:"6",md:"3",class:"d-flex justify-center align-center ga-2 order-4 order-sm-2 order-md-3"},{default:N(()=>[E("span",null,[b(Ce,{icon:"mdi-waveform"})]),b(de,{modelValue:u.value,"onUpdate:modelValue":m[4]||(m[4]=p=>u.value=p),mandatory:""},{default:N(()=>[b(P,{icon:"mdi-sine-wave",value:"sine"}),b(P,{icon:"mdi-sawtooth-wave",value:"sawtooth"}),b(P,{icon:"mdi-square-wave",value:"square"}),b(P,{icon:"mdi-triangle-wave",value:"triangle"})]),_:1},8,["modelValue"])]),_:1}),b(ne,{cols:"6",sm:"3",md:"2",class:"d-flex align-center justify-end ga-2 order-2 order-sm-3 order-md-4"},{default:N(()=>[b(re,{text:"Disminuir una octava aguda",location:"left"},{activator:N(({props:p})=>[b(P,Z(p,{size:"small",variant:"tonal",disabled:y.value.min>=y.value.max,icon:"mdi-music-note-minus",onClick:m[5]||(m[5]=w=>g(!1))}),null,16,["disabled"])]),_:1}),b(re,{text:"Incluir una octava aguda más",location:"top"},{activator:N(({props:p})=>[b(P,Z(p,{variant:"tonal",disabled:y.value.max>=7,icon:"mdi-music-note-plus",onClick:m[6]||(m[6]=w=>g(!0))}),null,16,["disabled"])]),_:1})]),_:1})]),_:1},8,["class"]))}}),bt=D({__name:"PianoKey",props:{note:{},variant:{}},emits:["pressStart","pressEnd"],setup(e,{emit:s}){const a=s,i=_(!1),l=()=>{i.value||(i.value=!0,a("pressStart",e.note.frequency.main))},o=()=>{i.value&&(i.value=!1,a("pressEnd",e.note.frequency.main))};return(t,r)=>(S(),R(P,{class:K(`piano-key key-${t.variant}`),onMousedown:l,onMouseup:o,onTouchstart:l,onTouchend:o},{default:N(()=>[Ue(t.$slots,"default",{},void 0,!0)]),_:3},8,["class"]))}}),es=x(bt,[["__scopeId","data-v-4c23215a"]]),Ct={class:"text-center"},_t={key:0},Et={key:1},Nt=D({__name:"PianoKeyNatural",props:{showClassicSystem:{type:Boolean,default:!0},showAmericanSystem:{type:Boolean,default:!0},note:{}},setup(e){return(s,a)=>(S(),R(es,{note:s.note,variant:"white"},{default:N(()=>[E("div",Ct,[s.showClassicSystem?(S(),F("div",_t,I(s.note.name.classic),1)):M("",!0),s.showAmericanSystem?(S(),F("div",Et,I(s.note.name.american),1)):M("",!0)])]),_:1},8,["note"]))}}),Ot=x(Nt,[["__scopeId","data-v-59d32181"]]),It={key:0},Mt={key:0},Tt={key:1},Rt={key:1},Pt={key:0},Lt={key:1},$t=D({__name:"PianoKeySemiSF",props:{showClassicSystem:{type:Boolean,default:!0},showAmericanSystem:{type:Boolean,default:!0},showSemiSharps:{type:Boolean,default:!0},showSemiFlats:{type:Boolean,default:!0},note:{}},setup(e){return(s,a)=>s.note!=B(C).EmptyNote?(S(),R(es,{key:0,note:s.note,variant:"black"},{default:N(()=>[s.showSemiSharps?(S(),F("div",It,[s.showClassicSystem?(S(),F("div",Mt,[ae(I(s.note.sharp.name.classic),1),a[0]||(a[0]=E("span",{class:"accidental"},"#",-1))])):M("",!0),s.showAmericanSystem?(S(),F("div",Tt,[ae(I(s.note.sharp.name.american),1),a[1]||(a[1]=E("span",{class:"accidental"},"#",-1))])):M("",!0)])):M("",!0),s.showSemiFlats?(S(),F("div",Rt,[s.showClassicSystem?(S(),F("div",Pt,[ae(I(s.note.flat.name.classic),1),a[2]||(a[2]=E("span",{class:"accidental"},"b",-1))])):M("",!0),s.showAmericanSystem?(S(),F("div",Lt,[ae(I(s.note.flat.name.american),1),a[3]||(a[3]=E("span",{class:"accidental"},"b",-1))])):M("",!0)])):M("",!0)]),_:1},8,["note"])):(S(),R(P,{key:1,class:"key-black empty"}))}}),kt=x($t,[["__scopeId","data-v-8d44301e"]]),Dt={key:0,class:"light-tail-indicator pressed"},Gt=D({__name:"PianoLightTail",props:{listenedFrequency:{default:()=>note.frequency.main},badFrequency:{type:Boolean,default:!0},note:{default:()=>C.EmptyNote},isPressed:{type:Boolean,default:!1}},emits:["key-state"],setup(e,{emit:s}){let a;(c=>{c[c.INACTIVE=0]="INACTIVE",c[c.LISTENED=2]="LISTENED",c[c.IS_BAD_LISTENED=4]="IS_BAD_LISTENED",c[c.PRESSED=8]="PRESSED",c[c.PRESSED_ANY=12]="PRESSED_ANY",c[c.LISTENED_PRESSED=10]="LISTENED_PRESSED",c[c.LISTENED_BAD=6]="LISTENED_BAD",c[c.LISTENED_PRESSED_BAD=14]="LISTENED_PRESSED_BAD"})(a||(a={}));const i=new Map([[0,"none"],[4,"none"],[2,"listened"],[8,"pressed"],[12,"pressed"],[10,"glow"],[6,"listened-bad"],[14,"pressed-bad"]]);e.note;const l=s,o=_(50),t=_(67),r=_(1),n=_(0);return J(()=>e.badFrequency,()=>{e.badFrequency?n.value|=4:n.value&=-5,l("key-state",n.value)}),J(()=>e.listenedFrequency,()=>{j.IsOnRange(e.note.frequency.min,e.note.frequency.max,e.listenedFrequency)?n.value|=2:n.value&=-3;const c=(n.value&2)==2,y=j.Invlerp(e.note.frequency.min,e.note.frequency.max,e.listenedFrequency),h=Math.abs(y-.5);o.value=c?y*100:50,t.value=c?j.Lerp(72,50,h):67,r.value=c?j.Lerp(1,.5,h):.75,l("key-state",n.value)}),J(()=>e.isPressed,()=>{e.isPressed===!0?n.value|=8:e.isPressed===!1&&(n.value&=-9),l("key-state",n.value)}),(c,y)=>(S(),F("div",{class:K(`light-tail ${c.note.isNatural()?"":"shrink"} ${B(i).get(n.value)} ${n.value}}`)},[y[2]||(y[2]=E("div",{class:"light-tail-border left"},null,-1)),n.value?(S(),F("div",Dt,y[0]||(y[0]=[E("div",{class:"light-tail-indicator-point"},null,-1)]))):M("",!0),E("div",{class:"light-tail-indicator listened",style:U(`left: ${o.value}%; height: ${t.value}%; scale: ${r.value}`)},y[1]||(y[1]=[E("div",{class:"light-tail-indicator-point"},null,-1)]),4),y[3]||(y[3]=E("div",{class:"light-tail-border right"},null,-1))],2))}}),Vt=x(Gt,[["__scopeId","data-v-0653e4c6"]]),Bt=D({__name:"PianoOctave",props:$e({showClassicSystem:{type:Boolean,default:!0},showAmericanSystem:{type:Boolean,default:!0},showSemiSharps:{type:Boolean,default:!0},showSemiFlats:{type:Boolean,default:!0},listenedFrequency:{default:0},badFrequency:{type:Boolean,default:!0},octaveId:{default:()=>T.OCTAVE_CENTRAL},keyPressedFrequency:{},keyUnpressedFrequency:{}},{pressedFrequencies:{default:new Set},pressedFrequenciesModifiers:{}}),emits:$e(["frequency-pressed","frequency-unpressed"],["update:pressedFrequencies"]),setup(e,{emit:s}){const a=s,i=Ds(e,"pressedFrequencies"),l=t=>{i.value.has(t)||(i.value.add(t),a("frequency-pressed",t))},o=t=>{i.value.has(t)&&(i.value.delete(t),a("frequency-unpressed",t))};return(t,r)=>(S(),R(ne,{class:"position-relative rounded-lg mt-4 piano-octave",xs:"12",sm:"6",md:"6",lg:"4",xl:"3",xxl:"3"},{default:N(()=>[b(ve,{class:"flex-nowrap piano-keys key-tails mx-0"},{default:N(()=>[(S(!0),F(k,null,V(B(T).GetNotesAtOctave(t.octaveId),n=>(S(),R(Vt,{key:n.frequency.main,note:n,"bad-frequency":t.badFrequency,"listened-frequency":t.listenedFrequency,"is-pressed":i.value.has(n.frequency.main)},null,8,["note","bad-frequency","listened-frequency","is-pressed"]))),128))]),_:1}),b(ve,{class:"flex-nowrap piano-keys white-keys"},{default:N(()=>[(S(!0),F(k,null,V(B(T).GetNaturalsAtOctave(t.octaveId),n=>(S(),R(Ot,{note:n,"show-classic-system":t.showClassicSystem,"show-american-system":t.showAmericanSystem,onPressStart:l,onPressEnd:o},null,8,["note","show-classic-system","show-american-system"]))),256))]),_:1}),b(ve,{class:"flex-nowrap piano-keys black-keys mt-6"},{default:N(()=>[(S(!0),F(k,null,V(B(T).GetSemisAtOctave(t.octaveId),n=>(S(),R(kt,{note:n,"show-classic-system":t.showClassicSystem,"show-american-system":t.showAmericanSystem,"show-semi-sharps":t.showSemiSharps,"show-semi-flats":t.showSemiFlats,onPressStart:l,onPressEnd:o},null,8,["note","show-classic-system","show-american-system","show-semi-sharps","show-semi-flats"]))),256))]),_:1}),b(ne,{cols:"12",class:"piano-octave-id"},{default:N(()=>[ae(I(t.octaveId),1)]),_:1})]),_:1}))}}),xt=x(Bt,[["__scopeId","data-v-179b8cac"]]),Ut=D({__name:"Piano",props:Gs({activeOctaves:{},waveform:{},showClassicSystem:{type:Boolean},showAmericanSystem:{type:Boolean},showSemiSharps:{type:Boolean},showSemiFlats:{type:Boolean},listenedFrequency:{},badFrequency:{type:Boolean},classes:{}},{waveform:"sine",...At}),emits:["pressed-frequencies"],setup(e,{emit:s}){const a=e,i=s,l=_(new Set),o=new Map,t=new Map;J(l,()=>{if(l.value.size==0)return;const u=1;o.forEach((d,g)=>{const f=d.audioCtx.currentTime;d.gainNode&&d.gainNode.gain.setValueAtTime(u,f),d.oscillator&&d.oscillator.frequency.setValueAtTime(g,f)}),i("pressed-frequencies",l.value)},{deep:!0});const r=()=>{let u=null;return t.forEach((d,g)=>{if(!d){u=g;return}}),u==null&&(u=new(AudioContext||window.AudioContext||window.webkitAudioContext)),u!=null&&t.set(u,!0),u},n=u=>{if(o.get(u)!=null||u===C.EmptyNote.frequency.main)return;let d=r();if(d==null)return;let g=d.createGain(),f=d.createOscillator();const m=d.currentTime;f&&(f.type=a.waveform??"sine",f.frequency.setValueAtTime(u,m),g?(g.gain.setValueAtTime(1,m),f.connect(g),g.connect(d.destination)):f.connect(d.destination),f.start()),o.set(u,{audioCtx:d,oscillator:f,gainNode:g}),l.value.add(u)},c=u=>{let d=o.get(u);if(d){if(d.oscillator)if(d.gainNode){const g=d.audioCtx.currentTime;d.gainNode.gain.setValueAtTime(d.gainNode.gain.value,g),d.gainNode.gain.exponentialRampToValueAtTime(1e-4,g+.05),d.oscillator.stop(g+.06)}else d.oscillator.stop();setTimeout(()=>{t.set(d.audioCtx,!1),o.delete(u),l.value.delete(u)},75)}},y=u=>{const d=xs.KEYS_CODE.indexOf(u.code);if(d===-1)return C.EmptyNote;const g=d<12,f=g?d:d-12;let m=C.EmptyNote;return u.altKey&&u.ctrlKey&&u.shiftKey?m=T.GetNotesAtOctave(g?1:2)[f]:u.altKey&&u.ctrlKey?m=T.GetNotesAtOctave(g?2:3)[f]:u.ctrlKey?m=T.GetNotesAtOctave(g?3:4)[f]:u.altKey&&u.shiftKey?m=T.GetNotesAtOctave(g?6:7)[f]:u.shiftKey?m=T.GetNotesAtOctave(g?5:6)[f]:m=T.GetNotesAtOctave(g?4:5)[f],m},h=u=>{if(u.repeat)return;const d=y(u);d!==C.EmptyNote&&(u.preventDefault(),u.stopPropagation(),n(d.frequency.main))},v=u=>{const d=y(u);d!==C.EmptyNote&&c(d.frequency.main)};return Vs(h),Bs(v),(u,d)=>(S(),R(we,{class:K(`bg-background ${u.classes}`)},{default:N(()=>[b(we,{class:"d-flex flex-wrap justify-center align-center ga-0 position-relative pa-2 pt-10",style:{"z-index":"10"}},{default:N(()=>[(S(!0),F(k,null,V(u.activeOctaves,g=>(S(),R(xt,{key:`p-oct-${g}`,octaveId:g,"listened-frequency":u.listenedFrequency,"bad-frequency":u.badFrequency,"show-classic-system":u.showClassicSystem,"show-american-system":u.showAmericanSystem,"show-semi-sharps":u.showSemiSharps,"show-semi-flats":u.showSemiFlats,"pressed-frequencies":l.value,"onUpdate:pressedFrequencies":d[0]||(d[0]=f=>l.value=f),onFrequencyPressed:n,onFrequencyUnpressed:c},null,8,["octaveId","listened-frequency","bad-frequency","show-classic-system","show-american-system","show-semi-sharps","show-semi-flats","pressed-frequencies"]))),128))]),_:1})]),_:1},8,["class"]))}});class oe{constructor(s,a,i){G(this,"note",C.EmptyNote);G(this,"unicode","&#x");G(this,"icon","mdi-music-clef-");this.note=s,this.unicode=a,this.icon=i}}(e=>{e.CLEF={GSOL4:new e(T.GetNoteAtOctave(4,7),"01D11E","mdi-music-clef-treble"),CDO4:new e(T.GetNoteAtOctave(4,0),"01D121","mdi-music-clef-alto"),FFA3:new e(T.GetNoteAtOctave(3,5),"01D122","mdi-music-clef-bass")},e.COMMON={TREBLE:{name:"Treble",clef:e.CLEF.GSOL4,top:0},BASS:{name:"Bass",clef:e.CLEF.FFA3,top:-2.5}}})(oe||(oe={}));const jt={class:"staff-lines-cont"},zt={class:"staff-lines"},Ht={class:"staff-line ledger"},Wt={class:"staff-line"},Yt={class:"clef"},Kt={class:"staff-lines"},Xt={class:"staff-line"},Jt={class:"staff-line ledger"},Qt={class:"clef"},Zt=D({__name:"StaffLines",setup(e){return(s,a)=>(S(),F("div",jt,[E("div",zt,[(S(),F(k,null,V(2,i=>E("div",Ht)),64)),(S(),F(k,null,V(5,i=>E("div",Wt)),64)),E("div",Yt,[b(Ce,{icon:B(oe).COMMON.TREBLE.clef.icon,style:U(`top: ${2+B(oe).COMMON.TREBLE.top}rem;`)},null,8,["icon","style"])])]),a[0]||(a[0]=E("div",{class:"staff-line ledger only"},null,-1)),E("div",Kt,[(S(),F(k,null,V(5,i=>E("div",Xt)),64)),(S(),F(k,null,V(2,i=>E("div",Jt)),64)),E("div",Qt,[b(Ce,{icon:B(oe).COMMON.BASS.clef.icon,style:U(`top: ${2+B(oe).COMMON.BASS.top}rem;`)},null,8,["icon","style"])])])]))}}),ea=x(Zt,[["__scopeId","data-v-b2c23dc3"]]),sa={class:"staff-notes-cont"},ta={class:"staff-notes spaces"},aa={key:0},na={key:1},ra={key:2},oa={class:"staff-notes lines"},la={key:0},ia={key:1},ua={key:2},ca=D({__name:"StaffNotesGuide",props:{showClassicSystem:{type:Boolean},showAmericanSystem:{type:Boolean},fullNotes:{default:()=>[]}},setup(e){const s=()=>[...e.fullNotes].reverse().filter((i,l)=>l%2==0),a=()=>[...e.fullNotes].reverse().filter((i,l)=>l%2==1);return(i,l)=>(S(),F("div",sa,[E("div",ta,[(S(!0),F(k,null,V(s(),(o,t)=>(S(),F("div",{class:K(`note ${t<3||t>12||t==7||t==8?"hid":""} justify-${i.showAmericanSystem&&i.showClassicSystem?"space-around":"center"}`),key:`s-n-${t}`},[i.showClassicSystem?(S(),F("span",aa,I(o.note.name.classic),1)):M("",!0),i.showAmericanSystem?(S(),F("span",na,I(o.note.name.american),1)):M("",!0),i.showClassicSystem||i.showAmericanSystem?(S(),F("sub",ra,I(o.octave),1)):M("",!0)],2))),128))]),E("div",oa,[(S(!0),F(k,null,V(a(),(o,t)=>(S(),F("div",{class:K(`note ${t<2||t>12||t==7?"hid":""} justify-${i.showAmericanSystem&&i.showClassicSystem?"space-around":"center"}`),key:`s-n-${t}`},[i.showClassicSystem?(S(),F("span",la,I(o.note.name.classic),1)):M("",!0),i.showAmericanSystem?(S(),F("span",ia,I(o.note.name.american),1)):M("",!0),i.showClassicSystem||i.showAmericanSystem?(S(),F("sub",ua,I(o.octave),1)):M("",!0)],2))),128))])]))}}),ma=x(ca,[["__scopeId","data-v-862453c5"]]);let Ge=performance.now(),_e=0,ss,ts=new Set,ge=!1;const as=e=>{_e=e-Ge,Ge=e,ts.forEach(s=>s.call(void 0,_e)),window.requestAnimationFrame(as)},ns=()=>{ge||(ge=!0,ss=window.requestAnimationFrame(as))},rs=()=>{ge&&(cancelAnimationFrame(ss),ge=!1)},os=()=>_e,ls=e=>ts.add(e),da=D({__name:"SheetMusicRecord",props:{showClassicSystem:{type:Boolean},showAmericanSystem:{type:Boolean}},setup(e,{expose:s}){const a=_(null);return s({updateScroll:()=>{a.value&&(a.value.scrollLeft=a.value.scrollWidth-a.value.clientWidth)}}),(l,o)=>(S(),F("div",{ref_key:"recordsRef",ref:a,class:"records",style:U(`width: ${l.showAmericanSystem||l.showClassicSystem?"calc(100% - 8rem)":"100%"};`)},[o[0]||(o[0]=E("div",{class:"fix"},null,-1)),Ue(l.$slots,"default",{},void 0)],4))}}),is=x(da,[["__scopeId","data-v-5b34165c"]]),va={key:0,class:"accidental"},fa=D({__name:"SheetMusicRecordNote",props:{noteIndex:{},isNatural:{type:Boolean},duration:{},isGood:{type:Boolean}},setup(e){return(s,a)=>(S(),F("div",{class:K(`record ${s.isGood?"good":""}`),style:U(`width:${s.duration*.1}px; margin-top:calc((${(s.noteIndex+1)*.5} * var(--line-space-height)) - var(--line-height));`)},[s.isNatural?M("",!0):(S(),F("span",va,"#"))],6))}}),us=x(fa,[["__scopeId","data-v-99886309"]]),ha=D({__name:"SheetMusicRecordListen",props:{showClassicSystem:{type:Boolean},showAmericanSystem:{type:Boolean},showSemiSharps:{type:Boolean},showSemiFlats:{type:Boolean},frequency:{default:0},isRunning:{type:Boolean,default:!1}},setup(e){const s=_([]),a=_(null);ls(o=>{var t;e.isRunning&&s.value.length>0&&(s.value[s.value.length-1].duration+=o,(t=a.value)==null||t.updateScroll())}),je(ns),ze(rs);const l=(o,t)=>o.noteIndex==t.noteIndex&&o.isNatural==t.isNatural&&o.isGood==(t.isGood??!1);return J(()=>e.frequency,(o,t)=>{if(!e.isRunning)return;const r=cs(e.frequency);if(r==null)return;const n=j.Invlerp(r.expected.min,r.expected.max,e.frequency),c=n>.4&&n<.6;console.log(n,c),(s.value.length===0||!l(s.value[s.value.length-1],{...r,isGood:c}))&&s.value.push({...r,isGood:c,duration:os()})}),(o,t)=>(S(),R(is,{ref_key:"RecordCont",ref:a,class:"listened","show-american-system":o.showAmericanSystem,"show-classic-system":o.showClassicSystem},{default:N(()=>[(S(!0),F(k,null,V(s.value,(r,n)=>(S(),R(us,{key:`smrn-${n}-${r.noteIndex}`,duration:r.duration,"note-index":r.noteIndex,"is-natural":r.isNatural,"is-good":r.isGood},null,8,["duration","note-index","is-natural","is-good"]))),128))]),_:1},8,["show-american-system","show-classic-system"]))}}),ya=D({__name:"SheetMusicRecordPress",props:{showClassicSystem:{type:Boolean},showAmericanSystem:{type:Boolean},showSemiSharps:{type:Boolean},showSemiFlats:{type:Boolean},frequencies:{default:()=>new Set}},setup(e){const s=_([]),a=_(null);return ls(l=>{var o;e.frequencies.size>0&&s.value.length>0&&(s.value[s.value.length-1].duration+=l,(o=a.value)==null||o.updateScroll())}),je(ns),ze(rs),J(()=>e.frequencies,(l,o)=>{if(e.frequencies.size===0)return;let t=new Set,r=!0,n=!0;e.frequencies.forEach(c=>{const y=cs(c);y&&(r=!1,(s.value.length==0||!s.value[s.value.length-1].notes.has(y))&&(n=!1,t.add(y)))}),!(r||n)&&s.value.push({notes:t,duration:os()})},{deep:!0}),(l,o)=>(S(),R(is,{ref_key:"RecordCont",ref:a,class:"pressed","show-american-system":l.showAmericanSystem,"show-classic-system":l.showClassicSystem},{default:N(()=>[(S(!0),F(k,null,V(s.value,(t,r)=>(S(),F("div",{class:"record-set",style:U(`width:${t.duration*.1}px`)},[(S(!0),F(k,null,V(t.notes,n=>(S(),R(us,{key:`s-smrn-${r}-${n.noteIndex}`,duration:t.duration,"note-index":n.noteIndex,"is-natural":n.isNatural,style:{position:"absolute"}},null,8,["duration","note-index","is-natural"]))),128))],4))),256))]),_:1},8,["show-american-system","show-classic-system"]))}}),pa=x(ya,[["__scopeId","data-v-9bd65152"]]),Sa={class:"settings d-flex justify-center"},wa={class:"staff"};let Te=[];const ga=()=>{let e=[];for(let s=1;s<=6;s++){const a=T.GetNaturalsAtOctave(s).map(i=>({octave:s,note:i,indexNote:s}));e=[...e,...a]}e.splice(0,6),e.splice(e.length-5),Te=e};ga();const Aa=e=>j.IsOnRange(1,6,e)?e==1?{min:0,max:0}:e==6?{min:29,max:30}:(e-=1,{min:(e-1)*7+1,max:e*7}):null,cs=e=>{const s=T.GetNoteFromFrequency(e),a=Aa(s.octave);if(a==null)return null;const i=T.GetNaturalsAtOctave(s.octave);let l=-1;if(s.note instanceof H?l=i.indexOf(s.note.sharp):l=i.indexOf(s.note),l===-1)return null;const o=s.note.isNatural();return l=Te.length-(a.min+l)-1,{noteIndex:l,isNatural:o,expected:s.note.frequency}},Fa=D({__name:"SheetMusic",props:{showClassicSystem:{type:Boolean},showAmericanSystem:{type:Boolean},showSemiSharps:{type:Boolean},showSemiFlats:{type:Boolean},listenedFrequency:{default:0},badFrequency:{type:Boolean,default:!0},pressedFrequencies:{default:()=>new Set},isRunning:{type:Boolean,default:!1}},setup(e){const s=_("listened");return(a,i)=>(S(),R(we,{class:"bg-background mx-4 my-4"},{default:N(()=>[E("div",Sa,[b(de,{modelValue:s.value,"onUpdate:modelValue":i[0]||(i[0]=l=>s.value=l),mandatory:""},{default:N(()=>[b(P,{icon:"mdi-microphone",value:"listened"}),b(P,{icon:"mdi-piano",value:"pressed"})]),_:1},8,["modelValue"])]),E("div",wa,[b(ea),a.showAmericanSystem||a.showClassicSystem?(S(),R(ma,{key:0,"show-american-system":a.showAmericanSystem,"show-classic-system":a.showClassicSystem,fullNotes:B(Te)},null,8,["show-american-system","show-classic-system","fullNotes"])):M("",!0),b(ha,{hidden:s.value=="pressed","show-american-system":a.showAmericanSystem,"show-classic-system":a.showClassicSystem,"show-semi-sharps":a.showSemiSharps,"show-semi-flats":a.showSemiFlats,frequency:a.listenedFrequency,"is-running":a.isRunning&&!a.badFrequency},null,8,["hidden","show-american-system","show-classic-system","show-semi-sharps","show-semi-flats","frequency","is-running"]),b(pa,{hidden:s.value=="listened","show-american-system":a.showAmericanSystem,"show-classic-system":a.showClassicSystem,"show-semi-sharps":a.showSemiSharps,"show-semi-flats":a.showSemiFlats,frequencies:a.pressedFrequencies},null,8,["hidden","show-american-system","show-classic-system","show-semi-sharps","show-semi-flats","frequencies"])])]),_:1}))}}),qa=x(Fa,[["__scopeId","data-v-95f2b78c"]]),Ea=D({__name:"Home",setup(e){const s=_(!1),a=_(0),i=_(!0),l=_({note:C.EmptyNote,octave:-1,indexNote:-1}),o=_(!0),t=_(!0),r=_(!0),n=_(!0),c=_([]),y=_("sine"),h=_(new Set);return(v,u)=>(S(),F(k,null,[b(pt,{ref:"tunerRef",classes:"order-1 order-md-1 position-sticky top-0","show-american-system":t.value,"show-classic-system":o.value,"show-semi-sharps":r.value,"show-semi-flats":n.value,"onUpdate:frequency":u[0]||(u[0]=d=>a.value=d),"onUpdate:note":u[1]||(u[1]=d=>l.value=d),"onUpdate:badFrequency":u[2]||(u[2]=d=>i.value=d),onIsRunning:u[3]||(u[3]=d=>s.value=d)},null,8,["show-american-system","show-classic-system","show-semi-sharps","show-semi-flats"]),b(qt,{classes:"order-3 order-md-2",onOctaves:u[4]||(u[4]=d=>{c.value=d}),"onShow:noteSystems":u[5]||(u[5]=(d,g)=>{o.value=d,t.value=g}),"onShow:noteSemis":u[6]||(u[6]=(d,g)=>{r.value=d,n.value=g}),onWaveform:u[7]||(u[7]=d=>{d&&(y.value=d)})}),b(Ut,{classes:"order-2 order-md-3","active-octaves":c.value,waveform:y.value,"show-american-system":t.value,"show-classic-system":o.value,"show-semi-sharps":r.value,"show-semi-flats":n.value,"listened-frequency":a.value,"bad-frequency":i.value,onPressedFrequencies:u[8]||(u[8]=d=>h.value=d)},null,8,["active-octaves","waveform","show-american-system","show-classic-system","show-semi-sharps","show-semi-flats","listened-frequency","bad-frequency"]),b(qa,{class:"order-4","show-american-system":t.value,"show-classic-system":o.value,"show-semi-sharps":r.value,"show-semi-flats":n.value,"is-running":s.value,"listened-frequency":a.value,"bad-frequency":i.value,"pressed-frequencies":h.value},null,8,["show-american-system","show-classic-system","show-semi-sharps","show-semi-flats","is-running","listened-frequency","bad-frequency","pressed-frequencies"])],64))}});export{Ea as default};
