var lt=Object.defineProperty;var ct=(e,i,o)=>i in e?lt(e,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[i]=o;var D=(e,i,o)=>ct(e,typeof i!="symbol"?i+"":i,o);import{d as k,u as ut,o as g,c as _,F as x,r as U,a as C,n as z,t as T,b as R,e as Z,_ as j,f as b,p as dt,g as mt,m as vt,h as ft,i as yt,j as ht,k as pt,l as de,q as gt,s as St,v as G,V as ke,w as F,x as I,y as N,z as L,A as pe,B as J,C as re,D as ye,E as M,G as ae,H as ge,I as he,J as Ge,K as oe,L as wt,M as At,N as Ft,P as qt,O as Ue,Q as je,R as fe}from"./index-D07XDjsX.js";import{c as H}from"./_commonjsHelpers-Cpj98o6Y.js";const K=class K{};D(K,"IsOnRange",(i,o,l)=>l<=o&&l>=i),D(K,"Clamp",(i,o=0,l=1)=>Math.min(l,Math.max(o,i))),D(K,"Lerp",(i,o,l)=>i*(1-l)+o*l),D(K,"Invlerp",(i,o,l)=>K.Clamp((l-i)/(o-i))),D(K,"ToRange",(i,o,l,a=0,t=1)=>K.Lerp(a,t,K.Invlerp(o,l,i)));let B=K;class E{constructor(i,o,l){D(this,"name",{classic:E.Classic.ENotes.NONE,american:E.American.ENotes.NONE});D(this,"frequency",{main:0,min:0,max:0});D(this,"isNatural",()=>!0);this.frequency.main=i,o&&(this.name.classic=o),l&&(this.name.american=l)}}class W extends E{constructor(o,l=E.Classic.ENotes.NONE,a=E.American.ENotes.NONE){super(o,l,a);D(this,"sharp",E.EmptyNote);D(this,"flat",E.EmptyNote);D(this,"isNatural",()=>!1)}}(e=>{(t=>{t[t.CLASSIC=0]="CLASSIC",t[t.AMERICAN=1]="AMERICAN"})(e.Systems||(e.Systems={})),(t=>{t[t.SHARP=0]="SHARP",t[t.FLAT=1]="FLAT",t[t.NATURAL=2]="NATURAL",t[t.DOUBLE_SHARP=3]="DOUBLE_SHARP",t[t.DOUBLE_FLAT=4]="DOUBLE_FLAT"})(e.Accidentals||(e.Accidentals={})),(t=>{(r=>{r.NONE="?",r.DO="DO",r.DOS_REF="DO# REb",r.RE="RE",r.RES_MIF="RE# MIb",r.MI="MI",r.FA="FA",r.FAS_SOLF="FA# SOLb",r.SOL="SOL",r.SOLS_LAF="SOL# LAb",r.LA="LA",r.LAS_SIF="LA# SIb",r.SI="SI"})(t.ENotes||(t.ENotes={}))})(e.Classic||(e.Classic={})),(t=>{(r=>{r.NONE="?",r.C="C",r.CS_DF="C# Db",r.D="D",r.DS_EF="D# Eb",r.E="E",r.F="F",r.FS_GF="F# Gb",r.G="G",r.GS_AF="G# Ab",r.A="A",r.AS_BF="A# Bb",r.B="B"})(t.ENotes||(t.ENotes={}))})(e.American||(e.American={}));let i=[new e(261.63,"DO","C"),new W(277.18,"DO# REb","C# Db"),new e(293.66,"RE","D"),new W(311.13,"RE# MIb","D# Eb"),new e(329.63,"MI","E"),new e(349.23,"FA","F"),new W(369.99,"FA# SOLb","F# Gb"),new e(392,"SOL","G"),new W(415.3,"SOL# LAb","G# Ab"),new e(440,"LA","A"),new W(466.16,"LA# SIb","A# Bb"),new e(493.88,"SI","B")];e.Notes=i,e.EmptyNote=new W(0);let o=[],l=[];const a=(t,r)=>Math.sqrt(t*r);e.FillMedFrequencys=(t,r,s)=>{for(let n=0;n<t.length;n++){{const c=n>0?t[n-1].frequency.main:t[t.length-1].frequency.main/2;t[n].frequency.min=a(c,t[n].frequency.main)}{const c=n<t.length-1?t[n+1].frequency.main:t[0].frequency.main*2;t[n].frequency.max=a(t[n].frequency.main,c)}t[n]instanceof W?(t[n].sharp=t[n-1],t[n].flat=t[n+1],s.push(t[n])):(r.push(t[n]),n<t.length-1&&!(t[n+1]instanceof W)&&s.push(e.EmptyNote))}},(0,e.FillMedFrequencys)(i,o,l),e.Naturals=o,e.Semis=l})(E||(E={}));var V;(e=>{e.OCTAVE_CENTRAL=4,e.OCTAVE_RANGE={MIN:1,MAX:7};const i=(n,c)=>n/Math.pow(2,c),o=(n,c)=>n*Math.pow(2,c),l=(n,c)=>n==e.OCTAVE_CENTRAL?c:n<e.OCTAVE_CENTRAL?i(c,e.OCTAVE_CENTRAL-n):o(c,n-e.OCTAVE_CENTRAL);let a=[],t=[],r=[];for(let n=e.OCTAVE_RANGE.MIN;n<=e.OCTAVE_RANGE.MAX;n++){let c=[],h=[],p=[];E.Notes.forEach(m=>{const u=l(n,m.frequency.main);let v;m instanceof W?v=new W(u,m.name.classic,m.name.american):v=new E(u,m.name.classic,m.name.american),c.push(v)}),E.FillMedFrequencys(c,h,p),a.push(c),t.push(h),r.push(p)}const s=n=>B.Clamp(n,e.OCTAVE_RANGE.MIN,e.OCTAVE_RANGE.MAX)-e.OCTAVE_RANGE.MIN;e.GetNotesAtOctave=n=>a[s(n)],e.GetNaturalsAtOctave=n=>t[s(n)],e.GetSemisAtOctave=n=>r[s(n)],e.GetNoteAtOctave=(n,c)=>(0,e.GetNotesAtOctave)(n)[c],e.INVALID_OCTAVE=-1,e.GetNoteFromFrequency=n=>{const p=Math.round(12*(Math.log(n/440)/Math.log(2)))+69,m=p%12,u=Math.floor(p/12)-1;return B.IsOnRange(e.OCTAVE_RANGE.MIN,e.OCTAVE_RANGE.MAX,u)?{note:e.GetNoteAtOctave(u,m),octave:u,indexNote:m}:{note:E.EmptyNote,octave:e.INVALID_OCTAVE,indexNote:-1}}})(V||(V={}));const _t=(e,i,o)=>{let l=parseInt(e,16)&255,a=parseInt(i,16)&255;return Math.round(l+(a-l)*o).toString(16).padStart(2,"0")},bt=(e,i,o)=>{let l=parseInt(e.slice(1),16),a=parseInt(i.slice(1),16),t=l>>16&255,r=l>>8&255,s=l&255,n=a>>16&255,c=a>>8&255,h=a&255,p=Math.round(t+(n-t)*o),m=Math.round(r+(c-r)*o),u=Math.round(s+(h-s)*o);return`#${(p<<16|m<<8|u).toString(16).padStart(6,"0")}`},Et=k({__name:"TunerDigitalNeedle",props:{frequency:{},noteFreq:{default:()=>E.EmptyNote.frequency},size:{},top:{},left:{},showNumbers:{type:Boolean}},setup(e){const i=ut(),o=a=>{a-=50,a=Math.abs(a);const t=i.global.current.value.colors.primary,r=i.global.current.value.colors["on-background"],s=i.global.current.value.colors["on-surface"];let n,c="ff";if(a<=10)n=t;else{const h=(a-10)/40;n=bt(s,r,h),c=_t("ff","40",h)}return n+c},l=()=>B.ToRange(e.frequency,e.noteFreq.min,e.noteFreq.max,-90,90);return(a,t)=>(g(),_("div",{class:"back-circle",style:z(`width:${a.size??24}em; height:${a.size??24}em; top:${a.top??1}em; left:${a.left??0}em`)},[(g(),_(x,null,U(101,(r,s)=>C("div",{class:"line-cont",style:z(`transform: rotateZ(${-90+s*1.8}deg);`)},[a.showNumbers&&s%10==0?(g(),_("span",{key:0,class:"num",style:z("color:"+o(s))},T(s-50),5)):R("",!0),C("span",{class:Z(`line ${s%10==0?"big":s%5==0?"half":"small"}`),style:z("background-color:"+o(s))},null,6)],4)),64)),C("div",{class:"line-cont",style:z(`transform: rotateZ(${l()}deg)`)},t[0]||(t[0]=[C("span",{class:"line needle"},null,-1)]),4)],4))}}),ze=j(Et,[["__scopeId","data-v-8d4cfd6b"]]);var te={},Ie={},Se=H&&H.__assign||function(){return Se=Object.assign||function(e){for(var i,o=1,l=arguments.length;o<l;o++){i=arguments[o];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},Se.apply(this,arguments)};Object.defineProperty(Ie,"__esModule",{value:!0});var Nt={threshold:.1,sampleRate:44100,probabilityThreshold:.1};function Ct(e){e===void 0&&(e={});var i=Se(Se({},Nt),e),o=i.threshold,l=i.sampleRate,a=i.probabilityThreshold;return function(r){var s;for(s=1;s<r.length;s*=2);s/=2;for(var n=s/2,c=new Float32Array(n),h=0,p,m=0;m<n;m++)c[m]=0;for(var m=1;m<n;m++)for(var u=0;u<n;u++){var v=r[u]-r[u+m];c[m]+=v*v}c[0]=1,c[1]=1;for(var w=0,m=1;m<n;m++)w+=c[m],c[m]*=m/w;for(p=2;p<n;p++)if(c[p]<o){for(;p+1<n&&c[p+1]<c[p];)p++;h=1-c[p];break}if(p===n||c[p]>=o||h<a)return null;var y,d,f;if(p<1?d=p:d=p-1,p+1<n?f=p+1:f=p,d===p)c[p]<=c[f]?y=p:y=f;else if(f===p)c[p]<=c[d]?y=p:y=d;else{var S=c[d],A=c[p],q=c[f];y=p+(q-S)/(2*(2*A-q-S))}return l/y}}Ie.YIN=Ct;var Me={},we=H&&H.__assign||function(){return we=Object.assign||function(e){for(var i,o=1,l=arguments.length;o<l;o++){i=arguments[o];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},we.apply(this,arguments)};Object.defineProperty(Me,"__esModule",{value:!0});var Ot={sampleRate:44100,minFrequency:82,maxFrequency:1e3,ratio:5,sensitivity:.1};function It(e){e===void 0&&(e={});var i=we(we({},Ot),e),o=i.sampleRate,l=i.minFrequency,a=i.maxFrequency,t=i.sensitivity,r=i.ratio,s=[],n=Math.ceil(o/l),c=Math.floor(o/a);return function(p){var m=p.length,u=0,v=1/0,w=-1/0,y,d,f,S,A,q,O,P;for(S=0;S<m;S++)if(c<=S&&S<=n){for(O=0,P=S,u=0,y=[],d=[];O<m-S;u++,P++,O++)y[u]=p[O],d[u]=p[P];var Y=y.length;for(f=[],q=0;q<Y;q++)f[q]=y[q]-d[q];var se=0;for(q=0;q<Y;q++)se+=Math.abs(f[q]);s[S]=se}for(A=c;A<n;A++)s[A]<v&&(v=s[A]),s[A]>w&&(w=s[A]);var ee=Math.round(t*(w-v)+v);for(A=c;A<=n&&s[A]>ee;A++);var ce=c/2;v=s[A];var Q=A;for(S=A-1;S<A+ce&&S<=n;S++)s[S]<v&&(v=s[S],Q=S);return Math.round(s[Q]*r)<w?o/Q:null}}Me.AMDF=It;var Re={},Ae=H&&H.__assign||function(){return Ae=Object.assign||function(e){for(var i,o=1,l=arguments.length;o<l;o++){i=arguments[o];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},Ae.apply(this,arguments)};Object.defineProperty(Re,"__esModule",{value:!0});var De={sampleRate:44100};function Mt(e){e===void 0&&(e=De);var i=Ae(Ae({},De),e),o=i.sampleRate;return function(a){var t=a.length,r=0,s,n,c,h;for(s=0;s<t;s++)h=a[s],r+=h*h;if(r=Math.sqrt(r/t),r<.01)return-1;var p=0,m=t-1,u=.2;for(s=0;s<t/2;s++)if(Math.abs(a[s])<u){p=s;break}for(s=1;s<t/2;s++)if(Math.abs(a[t-s])<u){m=t-s;break}var v=a.slice(p,m),w=v.length,y=new Array(w).fill(0);for(s=0;s<w;s++)for(n=0;n<w-s;n++)y[s]=y[s]+v[n]*v[n+s];for(c=0;y[c]>y[c+1];)c++;var d=-1,f=-1;for(s=c;s<w;s++)y[s]>d&&(d=y[s],f=s);var S=f,A=y[S-1],q=y[S],O=y[S+1],P=(A+O-2*q)/2,Y=(O-A)/2;return P&&(S=S-Y/(2*P)),o/S}}Re.ACF2PLUS=Mt;var Te={},Fe=H&&H.__assign||function(){return Fe=Object.assign||function(e){for(var i,o=1,l=arguments.length;o<l;o++){i=arguments[o];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},Fe.apply(this,arguments)};Object.defineProperty(Te,"__esModule",{value:!0});var Rt=6,Tt=3e3,Lt=3,Pt=.75,$t={sampleRate:44100};function kt(e){e===void 0&&(e={});var i=Fe(Fe({},$t),e),o=i.sampleRate;return function(a){for(var t=[],r=[],s=a.length,n=null,c=0,h=0,p=0,m=0;m<s;m++){var u=a[m];c=c+u,p=Math.max(p,u),h=Math.min(h,u)}c/=s,h-=c,p-=c;for(var v=p>-1*h?p:-1*h,w=v*Pt,y=0,d=-1,f=a.length,S,A,q;S=~~(o/(Math.pow(2,y)*Tt)),!(f<2);){var O=void 0,P=-1e3,Y=-1e6,se=-1e6,ee=!1,ce=!1;q=0,A=0;for(var m=2;m<f;m++){var Q=a[m]-c,be=a[m-1]-c;be<=0&&Q>0&&(ee=!0),be>=0&&Q<0&&(ce=!0),O=Q-be,P>-1e3&&(ce&&P<0&&O>=0&&Math.abs(Q)>=w&&m>Y+S&&(t[q++]=m,Y=m,ce=!1),ee&&P>0&&O<=0&&Math.abs(Q)>=w&&m>se+S&&(r[A++]=m,se=m,ee=!1)),P=O}if(q===0&&A===0)break;for(var Pe=void 0,ue=[],m=0;m<f;m++)ue[m]=0;for(var m=0;m<q;m++)for(var $=1;$<Lt;$++)m+$<q&&(Pe=Math.abs(t[m]-t[m+$]),ue[Pe]+=1);for(var ne=-1,Ee=-1,m=0;m<f;m++){for(var me=0,$=-1*S;$<=S;$++)m+$>=0&&m+$<f&&(me+=ue[m+$]);me===Ee?m===2*ne&&(ne=m):me>Ee&&(Ee=me,ne=m)}for(var ve=0,$e=0,$=-S;$<=S;$++)if(ne+$>=0&&ne+$<s){var Ne=ue[ne+$];Ne>0&&($e+=Ne,ve+=(ne+$)*Ne)}if(ve/=$e,d>-1&&Math.abs(ve*2-d)<=2*S){n=o/(Math.pow(2,y-1)*d);break}if(d=ve,y++,y>=Rt||f<2)break;var Ce=a.subarray(0);f===ue.length&&(Ce=new Float32Array(f/2));for(var m=0;m<f/2;m++)Ce[m]=(a[2*m]+a[2*m+1])/2;a=Ce,f/=2}return n}}Te.DynamicWavelet=kt;var Le={},qe=H&&H.__assign||function(){return qe=Object.assign||function(e){for(var i,o=1,l=arguments.length;o<l;o++){i=arguments[o];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},qe.apply(this,arguments)};Object.defineProperty(Le,"__esModule",{value:!0});var Dt={bufferSize:1024,cutoff:.97,sampleRate:44100};function xt(e){e===void 0&&(e={});var i=qe(qe({},Dt),e),o=i.bufferSize,l=i.cutoff,a=i.sampleRate,t=.5,r=80,s=new Float32Array(o),n=new Float32Array(o),c,h,p=[],m=[],u=[];function v(d){var f,S;n[0]=d[0]*d[0];for(var A=1;A<d.length;A+=1)n[A]=d[A]*d[A]+n[A-1];for(var q=0;q<d.length;q++){f=0,S=n[d.length-1-q]+n[d.length-1]-n[q];for(var A=0;A<d.length-q;A++)f+=d[A]*d[A+q];s[q]=2*f/S}}function w(d){var f=s[d-1],S=s[d],A=s[d+1],q=d,O=A+f-2*S;if(O===0)c=q,h=S;else{var P=f-A;c=q+P/(2*O),h=S-P*P/(8*O)}}function y(){for(var d=0,f=0;d<(s.length-1)/3&&s[d]>0;)d++;for(;d<s.length-1&&s[d]<=0;)d++;for(d==0&&(d=1);d<s.length-1;)if(s[d]>s[d-1]&&s[d]>=s[d+1]&&(f==0||s[d]>s[f])&&(f=d),d++,d<s.length-1&&s[d]<=0)for(f>0&&(p.push(f),f=0);d<s.length-1&&s[d]<=0;)d++;f>0&&p.push(f)}return function(f){var S;p=[],m=[],u=[],v(f),y();for(var A=-1/0,q=0;q<p.length;q++){var O=p[q];A=Math.max(A,s[O]),s[O]>t&&(w(O),u.push(h),m.push(c),A=Math.max(A,h))}if(m.length){for(var P=l*A,Y=0,q=0;q<u.length;q++)if(u[q]>=P){Y=q;break}var se=m[Y],ee=a/se;ee>r?S=ee:S=-1}else S=-1;return{probability:A,freq:S}}}Le.Macleod=xt;var Be={};(function(e){var i=H&&H.__assign||function(){return i=Object.assign||function(a){for(var t,r=1,s=arguments.length;r<s;r++){t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(a[n]=t[n])}return a},i.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.DEFAULT_FREQUENCIES_PARAMS={tempo:120,quantization:4,sampleRate:44100};function o(a,t){var r=a.map(function(u){return u(t)}).filter(function(u){return u!==null}).sort(function(u,v){return u-v});if(r.length===1)return r[0];if(r.length===2){var s=r[0],n=r[1];return s*2>n?Math.sqrt(s*n):s}else{var s=r[0],n=r[1],c=r[r.length-2],h=r[r.length-1],p=s*2>n?r:r.slice(1),m=c*2>h?p:p.slice(0,-1);return Math.pow(m.reduce(function(w,y){return w*y},1),1/m.length)}}function l(a,t,r){r===void 0&&(r={});var s=i(i({},e.DEFAULT_FREQUENCIES_PARAMS),r),n=s.tempo,c=s.quantization,h=s.sampleRate,p=t.length,m=Math.round(h*60/(c*n)),u;Array.isArray(a)?u=o.bind(null,a):u=a;for(var v=[],w=0,y=p-m;w<=y;w+=m){var d=t.slice(w,w+m),f=u(d);v.push(f)}return v}e.frequencies=l})(Be);Object.defineProperty(te,"__esModule",{value:!0});var He=Ie;te.YIN=He.YIN;var We=Me;te.AMDF=We.AMDF;var Ye=Re;te.ACF2PLUS=Ye.ACF2PLUS;var Ke=Te;te.DynamicWavelet=Ke.DynamicWavelet;var Xe=Le;te.Macleod=Xe.Macleod;var Je=Be;te.frequencies=Je.frequencies;var Vt=te.default={YIN:He.YIN,AMDF:We.AMDF,ACF2PLUS:Ye.ACF2PLUS,DynamicWavelet:Ke.DynamicWavelet,Macleod:Xe.Macleod,frequencies:Je.frequencies};const Gt=k({name:"Tuner",emits:["update:frequency","update:note","is-running","update:bad-frequency"],props:{classes:{type:String,default:""},showClassicSystem:{type:Boolean,default:!0},showAmericanSystem:{type:Boolean,default:!0},showSemiSharps:{type:Boolean,defailt:!0},showSemiFlats:{type:Boolean,defailt:!0}},setup(e,{emit:i,expose:o}){const l=b(null),a=b(null),t=b(0),r=b({note:E.EmptyNote,octave:-1,indexNote:-1}),s=b(!1),n=b(!0),c=b(null),h=b(new Date),p=500,m=Vt.YIN(),u=S=>{const A=V.GetNoteFromFrequency(S);return A.octave!==V.INVALID_OCTAVE&&(h.value=new Date),A},v=()=>{if(!a.value||!l.value||!s.value)return;const S=a.value.fftSize,A=new Float32Array(S);a.value.getFloatTimeDomainData(A);const q=m(A);if(q){const O=u(q);O.octave==-1?new Date().getTime()-h.value.getTime()>p&&(n.value=!0,i("update:bad-frequency",!0)):(t.value=q,r.value=O,n.value=!1,i("update:note",r.value),i("update:frequency",q),i("update:bad-frequency",!1))}requestAnimationFrame(v)},w=async()=>{if(s.value)return;l.value=new AudioContext,a.value=l.value.createAnalyser(),a.value.fftSize=2048,c.value=await navigator.mediaDevices.getUserMedia({audio:!0}),l.value.createMediaStreamSource(c.value).connect(a.value),s.value=!0,i("is-running",!0),v()},y=()=>{l.value&&l.value.close(),s.value=!1,i("is-running",!1),c.value!=null&&c.value.getTracks().forEach(S=>{S.stop()})},d=S=>S=="?"?S:e.showSemiFlats?e.showSemiSharps?S:S.split(" ")[1]:S.split(" ")[0],f=()=>{const S=B.Invlerp(r.value.note.frequency.min,r.value.note.frequency.max,t.value);return S>.4&&S<.6};return o({startTuner:w,stopTuner:y,getIsOnGoodNote:f}),{frequency:t,note:r,startTuner:w,stopTuner:y,running:s,badFrequency:n,getIsOnGoodNote:f,showSemiNotes:d,TunerDigitalNeedle:ze}}}),Ut=dt({id:String,text:String,...mt(vt({closeOnBack:!1,location:"end",locationStrategy:"connected",eager:!0,minWidth:0,offset:10,openOnClick:!1,openOnHover:!0,origin:"auto",scrim:!1,scrollStrategy:"reposition",transition:!1}),["absolute","persistent"])},"VTooltip"),X=ft()({name:"VTooltip",props:Ut(),emits:{"update:modelValue":e=>!0},setup(e,i){let{slots:o}=i;const l=yt(e,"modelValue"),{scopeId:a}=ht(),t=pt(),r=de(()=>e.id||`v-tooltip-${t}`),s=b(),n=de(()=>e.location.split(" ").length>1?e.location:e.location+" center"),c=de(()=>e.origin==="auto"||e.origin==="overlap"||e.origin.split(" ").length>1||e.location.split(" ").length>1?e.origin:e.origin+" center"),h=de(()=>e.transition?e.transition:l.value?"scale-transition":"fade-transition"),p=de(()=>G({"aria-describedby":r.value},e.activatorProps));return gt(()=>{const m=ke.filterProps(e);return F(ke,G({ref:s,class:["v-tooltip",e.class],style:e.style,id:r.value},m,{modelValue:l.value,"onUpdate:modelValue":u=>l.value=u,transition:h.value,absolute:!0,location:n.value,origin:c.value,persistent:!0,role:"tooltip",activatorProps:p.value,_disableGlobalStack:!0},a),{activator:o.activator,default:function(){var y;for(var u=arguments.length,v=new Array(u),w=0;w<u;w++)v[w]=arguments[w];return((y=o.default)==null?void 0:y.call(o,...v))??e.text}})}),St({},s)}}),jt={class:"tuner-note text-primary d-flex ga-1"},zt={class:"text-body-1 pt-4 position-relative frequency",style:{width:"8rem"}};function Bt(e,i,o,l,a,t){const r=ze;return g(),I(pe,{tag:"section",class:Z(`tuner justify-center ga-4 bg-background align-center mt-4 ${e.classes}`),style:{"z-index":"100"}},{default:N(()=>[e.running?(g(),I(X,{key:1,text:"Detener afinador",location:"start"},{activator:N(({props:s})=>[F(L,G(s,{icon:"mdi-stop",onClick:e.stopTuner}),null,16,["onClick"])]),_:1})):(g(),I(X,{key:0,text:"Iniciar afinador",location:"start"},{activator:N(({props:s})=>[F(L,G(s,{icon:"mdi-microphone",onClick:e.startTuner,color:"primary"}),null,16,["onClick"])]),_:1})),C("div",{class:"d-flex justify-center align-center ga-3",style:z(`opacity: ${e.badFrequency?"0.5":"1"}`)},[C("div",jt,[e.showClassicSystem||!e.showAmericanSystem?(g(),I(X,{key:0,text:"Nota en sistema clásico",location:"top"},{activator:N(({props:s})=>[e.note.note.isNatural()?(g(),_("span",G({key:0,class:"tuner-classic tuner-natural"},s),T(e.note.note.name.classic),17)):(g(),_("span",G({key:1,class:"tuner-classic tuner-semi"},s),T(e.showSemiNotes(e.note.note.name.classic)),17))]),_:1})):R("",!0),e.showAmericanSystem?(g(),I(X,{key:1,text:"Nota en sistema americano",location:"top"},{activator:N(({props:s})=>[e.note.note.isNatural()?(g(),_("span",G({key:0,class:"tuner-american tuner-natural"},s),T(e.note.note.name.american),17)):(g(),_("span",G({key:1,class:"tuner-american tuner-semi"},s),T(e.showSemiNotes(e.note.note.name.american)),17))]),_:1})):R("",!0),F(X,{text:"Octava",location:"top"},{activator:N(({props:s})=>[C("span",G({class:"tuner-octave"},s),T(e.note.octave),17)]),_:1})]),C("div",zt,[F(r,{frequency:e.frequency,noteFreq:e.note.note.frequency,size:10,top:-1,left:.33},null,8,["frequency","noteFreq"]),F(X,{text:"Frecuencia detectada",location:"right"},{activator:N(({props:s})=>[C("span",G({class:`${e.getIsOnGoodNote()?"ok":""}`},s),T(e.frequency.toFixed(2))+" Hz ",17)]),_:1})])],4)]),_:1},8,["class"])}const Ht=j(Gt,[["render",Bt],["__scopeId","data-v-2710ed65"]]),Wt={showClassicSystem:!0,showAmericanSystem:!0},Yt={showSemiSharps:!0,showSemiFlats:!0},Kt={...Wt,...Yt},Xt={listenedFrequency:0,badFrequency:!1},Jt={activeOctaves:[3,4,5],waveform:"sine"},xe="MiniTuner:Settings:Instrument",Qt=k({__name:"InstrumentSettings",props:{classes:{}},emits:["octaves","show:noteSystems","show:noteSemis","waveform"],setup(e,{emit:i}){const o=i;let l={...Jt,...Kt};const a=(y,d,f)=>{y&&(l={...l,...y.activeOctaves}),d&&(l={...l,...d}),f&&(f={...l,...f}),localStorage.setItem(xe,JSON.stringify(l))};(()=>{let y=localStorage.getItem(xe);y!=null&&(l=JSON.parse(y))})();const r=()=>{let y=[];return l.showClassicSystem&&y.push(E.Systems.CLASSIC),l.showAmericanSystem&&y.push(E.Systems.AMERICAN),o("show:noteSystems",l.showClassicSystem,l.showAmericanSystem),y},s=()=>{let y=[];return l.showSemiSharps&&y.push(E.Accidentals.SHARP),l.showSemiFlats&&y.push(E.Accidentals.FLAT),o("show:noteSemis",l.showSemiSharps,l.showSemiFlats),y};let n=()=>{};const c=()=>{let y={min:l.activeOctaves[0],max:l.activeOctaves[l.activeOctaves.length-1]};return n(),y};//!-- For save and load from localStorage --
const h=b(c()),p=b(r()),m=b(s()),u=b(l.waveform??"sine");J(p,y=>{const d=y.indexOf(E.Systems.CLASSIC)!=-1,f=y.indexOf(E.Systems.AMERICAN)!=-1;o("show:noteSystems",d,f),a(void 0,{showClassicSystem:d,showAmericanSystem:f})}),J(m,y=>{const d=y.indexOf(E.Accidentals.SHARP)!=-1,f=y.indexOf(E.Accidentals.FLAT)!=-1;o("show:noteSemis",d,f),a(void 0,void 0,{showSemiSharps:d,showSemiFlats:f})}),J(u,()=>{o("waveform",u.value),a({...l,waveform:u.value})}),n=()=>{const y=h.value.max-h.value.min+1,d=Array.from(Array(y).keys()).map(f=>f+h.value.min);o("octaves",d),a({...l,activeOctaves:d})},n();const v=(y=!0)=>{y?h.value.min-=1:h.value.min+=1,n()},w=(y=!0)=>{y?h.value.max+=1:h.value.max-=1,n()};return(y,d)=>(g(),I(he,{tag:"section","no-gutters":"",class:Z(`align-center px-3 my-2 position-relative gr-1 ${y.classes}`),style:{"z-index":"20"}},{default:N(()=>[F(re,{cols:"6",sm:"3",md:"2",class:"d-flex align-center justify-start ga-2 order-1"},{default:N(()=>[F(X,{text:"Incluir una octava grave más",location:"top"},{activator:N(({props:f})=>[F(L,G(f,{variant:"tonal",disabled:h.value.min<=1,icon:"mdi-music-note-plus",onClick:d[0]||(d[0]=S=>v(!0))}),null,16,["disabled"])]),_:1}),F(X,{text:"Disminuir una octava grave",location:"right"},{activator:N(({props:f})=>[F(L,G(f,{size:"small",variant:"tonal",disabled:h.value.min>=h.value.max,icon:"mdi-music-note-minus",onClick:d[1]||(d[1]=S=>v(!1))}),null,16,["disabled"])]),_:1})]),_:1}),F(re,{cols:"12",sm:"12",md:"5",class:"d-flex justify-space-evenly order-3 order-sm-4 order-md-2"},{default:N(()=>[F(ye,{multiple:"",modelValue:p.value,"onUpdate:modelValue":d[2]||(d[2]=f=>p.value=f)},{default:N(()=>[F(L,{value:M(E).Systems.CLASSIC},{default:N(()=>d[7]||(d[7]=[ae("Do, Re, ...")])),_:1},8,["value"]),F(L,{value:M(E).Systems.AMERICAN},{default:N(()=>d[8]||(d[8]=[ae("C, D, ...")])),_:1},8,["value"])]),_:1},8,["modelValue"]),F(ye,{multiple:"",modelValue:m.value,"onUpdate:modelValue":d[3]||(d[3]=f=>m.value=f),mandatory:""},{default:N(()=>[F(L,{icon:"mdi-music-accidental-sharp",value:M(E).Accidentals.SHARP},null,8,["value"]),F(L,{icon:"mdi-music-accidental-flat",value:M(E).Accidentals.FLAT},null,8,["value"])]),_:1},8,["modelValue"])]),_:1}),F(re,{cols:"12",sm:"6",md:"3",class:"d-flex justify-center align-center ga-2 order-4 order-sm-2 order-md-3"},{default:N(()=>[C("span",null,[F(ge,{icon:"mdi-waveform"})]),F(ye,{modelValue:u.value,"onUpdate:modelValue":d[4]||(d[4]=f=>u.value=f),mandatory:""},{default:N(()=>[F(L,{icon:"mdi-sine-wave",value:"sine"}),F(L,{icon:"mdi-sawtooth-wave",value:"sawtooth"}),F(L,{icon:"mdi-square-wave",value:"square"}),F(L,{icon:"mdi-triangle-wave",value:"triangle"})]),_:1},8,["modelValue"])]),_:1}),F(re,{cols:"6",sm:"3",md:"2",class:"d-flex align-center justify-end ga-2 order-2 order-sm-3 order-md-4"},{default:N(()=>[F(X,{text:"Disminuir una octava aguda",location:"left"},{activator:N(({props:f})=>[F(L,G(f,{size:"small",variant:"tonal",disabled:h.value.min>=h.value.max,icon:"mdi-music-note-minus",onClick:d[5]||(d[5]=S=>w(!1))}),null,16,["disabled"])]),_:1}),F(X,{text:"Incluir una octava aguda más",location:"top"},{activator:N(({props:f})=>[F(L,G(f,{variant:"tonal",disabled:h.value.max>=7,icon:"mdi-music-note-plus",onClick:d[6]||(d[6]=S=>w(!0))}),null,16,["disabled"])]),_:1})]),_:1})]),_:1},8,["class"]))}}),Zt=k({__name:"PianoKey",props:{note:{},variant:{}},emits:["pressStart","pressEnd"],setup(e,{emit:i}){const o=i,l=b(!1),a=()=>{l.value||(l.value=!0,o("pressStart",e.note.frequency.main))},t=()=>{l.value&&(l.value=!1,o("pressEnd",e.note.frequency.main))};return(r,s)=>(g(),I(L,{class:Z(`piano-key key-${r.variant}`),onMousedown:a,onMouseup:t,onTouchstart:a,onTouchend:t},{default:N(()=>[Ge(r.$slots,"default",{},void 0,!0)]),_:3},8,["class"]))}}),Qe=j(Zt,[["__scopeId","data-v-4c23215a"]]),es={class:"text-center"},ts={key:0},ss={key:1},ns=k({__name:"PianoKeyNatural",props:{note:{}},setup(e){const i=oe("show-classic-system",!0),o=oe("show-american-system",!0);return(l,a)=>(g(),I(Qe,{note:l.note,variant:"white"},{default:N(()=>[C("div",es,[M(i)?(g(),_("div",ts,T(l.note.name.classic),1)):R("",!0),M(o)?(g(),_("div",ss,T(l.note.name.american),1)):R("",!0)])]),_:1},8,["note"]))}}),as=j(ns,[["__scopeId","data-v-4575833c"]]),rs={key:0},os={key:0},is={key:1},ls={key:1},cs={key:0},us={key:1},ds=k({__name:"PianoKeySemiSF",props:{note:{}},setup(e){const i=oe("show-classic-system",!0),o=oe("show-american-system",!0),l=oe("show-semi-sharps",!0),a=oe("show-semi-flats",!0);return(t,r)=>t.note!=M(E).EmptyNote?(g(),I(Qe,{key:0,note:t.note,variant:"black"},{default:N(()=>[M(l)?(g(),_("div",rs,[M(i)?(g(),_("div",os,[ae(T(t.note.sharp.name.classic),1),r[0]||(r[0]=C("span",{class:"accidental"},"#",-1))])):R("",!0),M(o)?(g(),_("div",is,[ae(T(t.note.sharp.name.american),1),r[1]||(r[1]=C("span",{class:"accidental"},"#",-1))])):R("",!0)])):R("",!0),M(a)?(g(),_("div",ls,[M(i)?(g(),_("div",cs,[ae(T(t.note.flat.name.classic),1),r[2]||(r[2]=C("span",{class:"accidental"},"b",-1))])):R("",!0),M(o)?(g(),_("div",us,[ae(T(t.note.flat.name.american),1),r[3]||(r[3]=C("span",{class:"accidental"},"b",-1))])):R("",!0)])):R("",!0)]),_:1},8,["note"])):(g(),I(L,{key:1,class:"key-black empty"}))}}),ms=j(ds,[["__scopeId","data-v-fbb48cc3"]]),vs={key:0,class:"light-tail-indicator pressed"},fs=k({__name:"PianoLightTail",props:{listenedFrequency:{default:()=>note.frequency.main},badFrequency:{type:Boolean,default:!0},note:{default:()=>E.EmptyNote},isPressed:{type:Boolean,default:!1}},emits:["key-state"],setup(e,{emit:i}){let o;(c=>{c[c.INACTIVE=0]="INACTIVE",c[c.LISTENED=2]="LISTENED",c[c.IS_BAD_LISTENED=4]="IS_BAD_LISTENED",c[c.PRESSED=8]="PRESSED",c[c.PRESSED_ANY=12]="PRESSED_ANY",c[c.LISTENED_PRESSED=10]="LISTENED_PRESSED",c[c.LISTENED_BAD=6]="LISTENED_BAD",c[c.LISTENED_PRESSED_BAD=14]="LISTENED_PRESSED_BAD"})(o||(o={}));const l=new Map([[0,"none"],[4,"none"],[2,"listened"],[8,"pressed"],[12,"pressed"],[10,"glow"],[6,"listened-bad"],[14,"pressed-bad"]]);e.note;const a=i,t=b(50),r=b(0),s=b(1),n=b(0);return J(()=>e.badFrequency,()=>{e.badFrequency?n.value|=4:n.value&=-5,a("key-state",n.value)}),J(()=>e.listenedFrequency,()=>{B.IsOnRange(e.note.frequency.min,e.note.frequency.max,e.listenedFrequency)?n.value|=2:n.value&=-3;const c=(n.value&2)==2,h=B.Invlerp(e.note.frequency.min,e.note.frequency.max,e.listenedFrequency),p=Math.abs(h-.5);t.value=c?h*100:50,r.value=c?B.Lerp(1,.25,p):0,s.value=c?B.Lerp(1,.5,p):.75,a("key-state",n.value)}),J(()=>e.isPressed,()=>{e.isPressed===!0?n.value|=8:e.isPressed===!1&&(n.value&=-9),a("key-state",n.value)}),(c,h)=>(g(),_("div",{class:Z(`light-tail ${c.note.isNatural()?"":"shrink"} ${M(l).get(n.value)} ${n.value}}`)},[h[2]||(h[2]=C("div",{class:"light-tail-border left"},null,-1)),n.value?(g(),_("div",vs,h[0]||(h[0]=[C("div",{class:"light-tail-indicator-point"},null,-1)]))):R("",!0),C("div",{class:"light-tail-indicator listened",style:z(`left: ${t.value}%; scale: ${s.value}; opacity: ${r.value}`)},h[1]||(h[1]=[C("div",{class:"light-tail-indicator-point"},null,-1)]),4),h[3]||(h[3]=C("div",{class:"light-tail-border right"},null,-1))],2))}}),ys=j(fs,[["__scopeId","data-v-8ad410a7"]]),hs=k({__name:"PianoOctave",props:{listenedFrequency:{default:0},badFrequency:{type:Boolean,default:!0},octaveId:{default:()=>V.OCTAVE_CENTRAL},keyPressedFrequency:{},keyUnpressedFrequency:{},pressedFrequencies:{}},emits:["frequency-pressed","frequency-unpressed"],setup(e,{emit:i}){const o=i,l=t=>{o("frequency-pressed",t)},a=t=>{o("frequency-unpressed",t)};return(t,r)=>(g(),I(re,{class:"position-relative rounded-lg mt-4 piano-octave",xs:"12",sm:"6",md:"6",lg:"4",xl:"3",xxl:"3"},{default:N(()=>[F(he,{class:"flex-nowrap piano-keys key-tails mx-0"},{default:N(()=>[(g(!0),_(x,null,U(M(V).GetNotesAtOctave(t.octaveId),s=>(g(),I(ys,{key:s.frequency.main,note:s,"listened-frequency":t.listenedFrequency,"bad-frequency":t.badFrequency,"is-pressed":t.pressedFrequencies.has(s.frequency.main)},null,8,["note","listened-frequency","bad-frequency","is-pressed"]))),128))]),_:1}),F(he,{class:"flex-nowrap piano-keys white-keys"},{default:N(()=>[(g(!0),_(x,null,U(M(V).GetNaturalsAtOctave(t.octaveId),s=>(g(),I(as,{note:s,onPressStart:l,onPressEnd:a},null,8,["note"]))),256))]),_:1}),F(he,{class:"flex-nowrap piano-keys black-keys mt-6"},{default:N(()=>[(g(!0),_(x,null,U(M(V).GetSemisAtOctave(t.octaveId),s=>(g(),I(ms,{note:s,onPressStart:l,onPressEnd:a},null,8,["note"]))),256))]),_:1}),F(re,{cols:"12",class:"piano-octave-id"},{default:N(()=>[ae(T(t.octaveId),1)]),_:1})]),_:1}))}}),ps=j(hs,[["__scopeId","data-v-63c25daf"]]),gs=k({__name:"Piano",props:wt({activeOctaves:{},waveform:{},listenedFrequency:{},badFrequency:{type:Boolean},classes:{}},{waveform:"sine",...Xt}),emits:["pressed-frequencies"],setup(e,{emit:i}){const o=e,l=i,a=b(new Set),t=new Map,r=new Map;J(a,()=>{if(a.value.size==0)return;const u=1;t.forEach((v,w)=>{const y=v.audioCtx.currentTime;v.gainNode&&v.gainNode.gain.setValueAtTime(u,y),v.oscillator&&v.oscillator.frequency.setValueAtTime(w,y)}),l("pressed-frequencies",a.value)},{deep:!0});const s=()=>{let u=null;return r.forEach((v,w)=>{if(!v){u=w;return}}),u==null&&(u=new(AudioContext||window.AudioContext||window.webkitAudioContext)),u!=null&&r.set(u,!0),u},n=u=>{if(t.get(u)!=null||u===E.EmptyNote.frequency.main)return;let v=s();if(v==null)return;let w=v.createGain(),y=v.createOscillator();const d=v.currentTime;y&&(y.type=o.waveform??"sine",y.frequency.setValueAtTime(u,d),w?(w.gain.setValueAtTime(1e-4,d),w.gain.linearRampToValueAtTime(1,d+.025),y.connect(w),w.connect(v.destination)):y.connect(v.destination),y.start()),t.set(u,{audioCtx:v,oscillator:y,gainNode:w}),a.value.add(u)},c=u=>{let v=t.get(u);if(v){if(v.oscillator)if(v.gainNode){const w=v.audioCtx.currentTime;v.gainNode.gain.setValueAtTime(v.gainNode.gain.value,w),v.gainNode.gain.exponentialRampToValueAtTime(1e-4,w+.05),v.oscillator.stop(w+.06)}else v.oscillator.stop();setTimeout(()=>{r.set(v.audioCtx,!1),t.delete(u),a.value.delete(u)},75)}},h=u=>{const v=qt.KEYS_CODE.indexOf(u.code);if(v===-1)return E.EmptyNote;const w=v<12,y=w?v:v-12;let d=E.EmptyNote,f;return u.altKey&&u.ctrlKey&&u.shiftKey?f=w?1:2:u.altKey&&u.ctrlKey?f=w?2:3:u.ctrlKey?f=w?3:4:u.altKey&&u.shiftKey?f=w?6:7:u.shiftKey?f=w?5:6:f=w?4:5,d=V.GetNotesAtOctave(f)[y],d},p=u=>{if(u.repeat)return;const v=h(u);v!==E.EmptyNote&&(u.preventDefault(),u.stopPropagation(),n(v.frequency.main))},m=u=>{const v=h(u);v!==E.EmptyNote&&c(v.frequency.main)};return At(p),Ft(m),(u,v)=>(g(),I(pe,{tag:"section",class:Z(`bg-background ${u.classes}`)},{default:N(()=>[F(pe,{class:"d-flex flex-wrap justify-center align-center ga-0 position-relative pa-2 pt-10",style:{"z-index":"10"}},{default:N(()=>[(g(!0),_(x,null,U(u.activeOctaves,w=>(g(),I(ps,{key:`p-oct-${w}`,octaveId:w,"listened-frequency":u.listenedFrequency,"bad-frequency":u.badFrequency,"pressed-frequencies":a.value,onFrequencyPressed:n,onFrequencyUnpressed:c},null,8,["octaveId","listened-frequency","bad-frequency","pressed-frequencies"]))),128))]),_:1})]),_:1},8,["class"]))}});class ie{constructor(i,o,l){D(this,"note",E.EmptyNote);D(this,"unicode","&#x");D(this,"icon","mdi-music-clef-");this.note=i,this.unicode=o,this.icon=l}}(e=>{e.CLEF={GSOL4:new e(V.GetNoteAtOctave(4,7),"01D11E","mdi-music-clef-treble"),CDO4:new e(V.GetNoteAtOctave(4,0),"01D121","mdi-music-clef-alto"),FFA3:new e(V.GetNoteAtOctave(3,5),"01D122","mdi-music-clef-bass")},e.COMMON={TREBLE:{name:"Treble",clef:e.CLEF.GSOL4,top:0},BASS:{name:"Bass",clef:e.CLEF.FFA3,top:-2.5}}})(ie||(ie={}));var le;(e=>{let i=[];(()=>{let a=[];for(let t=1;t<=6;t++){const r=V.GetNaturalsAtOctave(t).map(s=>({octave:t,note:s,indexNote:t}));a=[...a,...r]}a.splice(0,6),a.splice(a.length-5),i=a})(),e.FullNotes=i;const l=a=>B.IsOnRange(1,6,a)?a==1?{min:0,max:0}:a==6?{min:29,max:30}:(a-=1,{min:(a-1)*7+1,max:a*7}):null;e.getNoteIndex=a=>{const t=V.GetNoteFromFrequency(a),r=l(t.octave);if(r==null)return null;const s=V.GetNaturalsAtOctave(t.octave);let n=-1;if(t.note instanceof W?n=s.indexOf(t.note.sharp):n=s.indexOf(t.note),n===-1)return null;const c=t.note.isNatural();return n=i.length-(r.min+n)-1,{noteIndex:n,isNatural:c,expected:t.note.frequency}}})(le||(le={}));const Ss={class:"staff-lines-cont"},ws={class:"staff-lines"},As={class:"staff-line ledger"},Fs={class:"staff-line"},qs={class:"clef"},_s={class:"staff-lines"},bs={class:"staff-line"},Es={class:"staff-line ledger"},Ns={class:"clef"},Cs=k({__name:"StaffLines",setup(e){return(i,o)=>(g(),_("div",Ss,[C("div",ws,[(g(),_(x,null,U(2,l=>C("div",As)),64)),(g(),_(x,null,U(5,l=>C("div",Fs)),64)),C("div",qs,[F(ge,{icon:M(ie).COMMON.TREBLE.clef.icon,style:z(`top: ${2+M(ie).COMMON.TREBLE.top}rem;`)},null,8,["icon","style"])])]),o[0]||(o[0]=C("div",{class:"staff-line ledger only"},null,-1)),C("div",_s,[(g(),_(x,null,U(5,l=>C("div",bs)),64)),(g(),_(x,null,U(2,l=>C("div",Es)),64)),C("div",Ns,[F(ge,{icon:M(ie).COMMON.BASS.clef.icon,style:z(`top: ${2+M(ie).COMMON.BASS.top}rem;`)},null,8,["icon","style"])])])]))}}),Os=j(Cs,[["__scopeId","data-v-6a11ef11"]]),Is={class:"staff-notes-cont"},Ms={class:"staff-notes spaces"},Rs={key:0},Ts={key:1},Ls={key:2},Ps={class:"staff-notes lines"},$s={key:0},ks={key:1},Ds={key:2},xs=k({__name:"StaffNotesGuide",props:{showClassicSystem:{type:Boolean},showAmericanSystem:{type:Boolean}},setup(e){const i=()=>[...le.FullNotes].reverse().filter((l,a)=>a%2==0),o=()=>[...le.FullNotes].reverse().filter((l,a)=>a%2==1);return(l,a)=>(g(),_("div",Is,[C("div",Ms,[(g(!0),_(x,null,U(i(),(t,r)=>(g(),_("div",{class:Z(`note ${r<3||r>12||r==7||r==8?"hid":""} justify-${l.showAmericanSystem&&l.showClassicSystem?"space-around":"center"}`),key:`s-n-${r}`},[l.showClassicSystem?(g(),_("span",Rs,T(t.note.name.classic),1)):R("",!0),l.showAmericanSystem?(g(),_("span",Ts,T(t.note.name.american),1)):R("",!0),l.showClassicSystem||l.showAmericanSystem?(g(),_("sub",Ls,T(t.octave),1)):R("",!0)],2))),128))]),C("div",Ps,[(g(!0),_(x,null,U(o(),(t,r)=>(g(),_("div",{class:Z(`note ${r<2||r>12||r==7?"hid":""} justify-${l.showAmericanSystem&&l.showClassicSystem?"space-around":"center"}`),key:`s-n-${r}`},[l.showClassicSystem?(g(),_("span",$s,T(t.note.name.classic),1)):R("",!0),l.showAmericanSystem?(g(),_("span",ks,T(t.note.name.american),1)):R("",!0),l.showClassicSystem||l.showAmericanSystem?(g(),_("sub",Ds,T(t.octave),1)):R("",!0)],2))),128))])]))}}),Vs=j(xs,[["__scopeId","data-v-44ae142e"]]);let Ve=performance.now(),Oe=0,Ze,et=new Set,_e=!1;const tt=e=>{Oe=e-Ve,Ve=e,et.forEach(i=>i.call(void 0,Oe)),window.requestAnimationFrame(tt)},st=()=>{_e||(_e=!0,Ze=window.requestAnimationFrame(tt))},nt=()=>{_e&&(cancelAnimationFrame(Ze),_e=!1)},at=()=>Oe,rt=e=>et.add(e),Gs=k({__name:"SheetMusicRecord",props:{showClassicSystem:{type:Boolean},showAmericanSystem:{type:Boolean}},setup(e,{expose:i}){const o=b(null);return i({updateScroll:()=>{o.value&&(o.value.scrollLeft=o.value.scrollWidth-o.value.clientWidth)}}),(a,t)=>(g(),_("div",{ref_key:"recordsRef",ref:o,class:"records",style:z(`width: ${a.showAmericanSystem||a.showClassicSystem?"calc(100% - 8rem)":"100%"};`)},[t[0]||(t[0]=C("div",{class:"fix"},null,-1)),Ge(a.$slots,"default",{},void 0)],4))}}),ot=j(Gs,[["__scopeId","data-v-5b34165c"]]),Us={key:0,class:"accidental"},js=k({__name:"SheetMusicRecordNote",props:{noteIndex:{},isNatural:{type:Boolean},duration:{},isGood:{type:Boolean}},setup(e){return(i,o)=>(g(),_("div",{class:Z(`record ${i.isGood?"good":""}`),style:z(`width:${i.duration*.1}px; margin-top:calc((${(i.noteIndex+1)*.5} * var(--line-space-height)) - var(--line-height));`)},[i.isNatural?R("",!0):(g(),_("span",Us,"#"))],6))}}),it=j(js,[["__scopeId","data-v-3131fc25"]]),zs=k({__name:"SheetMusicRecordListen",props:{showClassicSystem:{type:Boolean},showAmericanSystem:{type:Boolean},frequency:{default:0},isRunning:{type:Boolean,default:!1}},setup(e,{expose:i}){const o=b([]),l=b(null);i({cleanRecord:()=>{o.value.splice(0)}}),rt(s=>{var n;e.isRunning&&o.value.length>0&&(o.value[o.value.length-1].duration+=s,(n=l.value)==null||n.updateScroll())}),Ue(st),je(nt);const r=(s,n)=>s.noteIndex==n.noteIndex&&s.isNatural==n.isNatural&&s.isGood==(n.isGood??!1);return J(()=>e.frequency,(s,n)=>{if(!e.isRunning)return;const c=le.getNoteIndex(e.frequency);if(c==null)return;const h=B.Invlerp(c.expected.min,c.expected.max,e.frequency),p=h>.4&&h<.6;(o.value.length===0||!r(o.value[o.value.length-1],{...c,isGood:p}))&&o.value.push({...c,isGood:p,duration:at()})}),(s,n)=>(g(),I(ot,{ref_key:"RecordCont",ref:l,class:"listened","show-american-system":s.showAmericanSystem,"show-classic-system":s.showClassicSystem},{default:N(()=>[(g(!0),_(x,null,U(o.value,(c,h)=>(g(),I(it,{key:`smrn-${h}-${c.noteIndex}`,duration:c.duration,"note-index":c.noteIndex,"is-natural":c.isNatural,"is-good":c.isGood},null,8,["duration","note-index","is-natural","is-good"]))),128))]),_:1},8,["show-american-system","show-classic-system"]))}}),Bs=k({__name:"SheetMusicRecordPress",props:{showClassicSystem:{type:Boolean},showAmericanSystem:{type:Boolean},frequencies:{default:()=>new Set}},setup(e,{expose:i}){const o=b([]),l=b(null);return i({cleanRecord:()=>{o.value.splice(0)}}),rt(r=>{var s;e.frequencies.size>0&&o.value.length>0&&(o.value[o.value.length-1].duration+=r,(s=l.value)==null||s.updateScroll())}),Ue(st),je(nt),J(()=>e.frequencies,(r,s)=>{if(e.frequencies.size===0)return;let n=new Set,c=!0,h=!0;e.frequencies.forEach(p=>{const m=le.getNoteIndex(p);m&&(c=!1,(o.value.length==0||!o.value[o.value.length-1].notes.has(m))&&(h=!1,n.add(m)))}),!(c||h)&&o.value.push({notes:n,duration:at()})},{deep:!0}),(r,s)=>(g(),I(ot,{ref_key:"RecordCont",ref:l,class:"pressed","show-american-system":r.showAmericanSystem,"show-classic-system":r.showClassicSystem},{default:N(()=>[(g(!0),_(x,null,U(o.value,(n,c)=>(g(),_("div",{class:"record-set",style:z(`width:${n.duration*.1}px`)},[(g(!0),_(x,null,U(n.notes,h=>(g(),I(it,{key:`s-smrn-${c}-${h.noteIndex}`,duration:n.duration,"note-index":h.noteIndex,"is-natural":h.isNatural,"is-good":"",style:{position:"absolute"}},null,8,["duration","note-index","is-natural"]))),128))],4))),256))]),_:1},8,["show-american-system","show-classic-system"]))}}),Hs=j(Bs,[["__scopeId","data-v-1d38a169"]]),Ws={class:"settings d-flex justify-center ga-2"},Ys={class:"d-flex ga-1 align-center"},Ks={key:0,class:"staff"},Xs=k({__name:"SheetMusic",props:{showClassicSystem:{type:Boolean},showAmericanSystem:{type:Boolean},listenedFrequency:{default:0},badFrequency:{type:Boolean,default:!0},pressedFrequencies:{default:()=>new Set},isRunning:{type:Boolean,default:!1},listenedNote:{default:()=>{}}},setup(e){const i=b("listened"),o=b(null),l=b(null),a=()=>{var t,r;i.value==="listened"&&((t=o.value)==null||t.cleanRecord()),i.value==="pressed"&&((r=l.value)==null||r.cleanRecord())};return J(()=>[e.listenedFrequency,e.pressedFrequencies],()=>{e.isRunning&&e.listenedNote&&!e.badFrequency&&e.pressedFrequencies.size==0?i.value="listened":e.pressedFrequencies.size>0&&e.badFrequency&&(i.value="pressed")},{deep:!0}),(t,r)=>(g(),I(pe,{tag:"section",class:"bg-background my-4 px-4 py-2"},{default:N(()=>[C("div",Ws,[C("div",Ys,[F(ge,{icon:"mdi-playlist-music-outline"}),F(ye,{modelValue:i.value,"onUpdate:modelValue":r[0]||(r[0]=s=>i.value=s)},{default:N(()=>[F(L,{icon:"mdi-microphone",value:"listened"}),F(L,{icon:"mdi-piano",value:"pressed"})]),_:1},8,["modelValue"])]),F(L,{icon:"mdi-restart",variant:"tonal",size:"small",onClick:a})]),i.value?(g(),_("div",Ks,[F(Os),t.showAmericanSystem||t.showClassicSystem?(g(),I(Vs,{key:0,"show-american-system":t.showAmericanSystem,"show-classic-system":t.showClassicSystem},null,8,["show-american-system","show-classic-system"])):R("",!0),F(zs,{ref_key:"recordListen",ref:o,hidden:i.value=="pressed","show-american-system":t.showAmericanSystem,"show-classic-system":t.showClassicSystem,frequency:t.listenedFrequency,"is-running":t.isRunning&&!t.badFrequency},null,8,["hidden","show-american-system","show-classic-system","frequency","is-running"]),F(Hs,{ref_key:"recordPress",ref:l,hidden:i.value=="listened","show-american-system":t.showAmericanSystem,"show-classic-system":t.showClassicSystem,frequencies:t.pressedFrequencies},null,8,["hidden","show-american-system","show-classic-system","frequencies"])])):R("",!0)]),_:1}))}}),Js=j(Xs,[["__scopeId","data-v-d362f0b8"]]),tn=k({__name:"Home",setup(e){const i=b(!1),o=b(0),l=b(!0),a=b({note:E.EmptyNote,octave:-1,indexNote:-1}),t=b(!0),r=b(!0),s=b(!0),n=b(!0);fe("show-classic-system",t),fe("show-american-system",r),fe("show-semi-sharps",s),fe("show-semi-flats",n);const c=b([]),h=b("sine"),p=b(new Set);return(m,u)=>(g(),_(x,null,[F(Ht,{ref:"tunerRef",classes:"order-1 order-md-1 position-sticky top-0","show-american-system":r.value,"show-classic-system":t.value,"show-semi-sharps":s.value,"show-semi-flats":n.value,"onUpdate:frequency":u[0]||(u[0]=v=>o.value=v),"onUpdate:note":u[1]||(u[1]=v=>a.value=v),"onUpdate:badFrequency":u[2]||(u[2]=v=>l.value=v),onIsRunning:u[3]||(u[3]=v=>i.value=v)},null,8,["show-american-system","show-classic-system","show-semi-sharps","show-semi-flats"]),F(Qt,{classes:"order-3 order-md-2",onOctaves:u[4]||(u[4]=v=>{c.value=v}),"onShow:noteSystems":u[5]||(u[5]=(v,w)=>{t.value=v,r.value=w}),"onShow:noteSemis":u[6]||(u[6]=(v,w)=>{s.value=v,n.value=w}),onWaveform:u[7]||(u[7]=v=>{v&&(h.value=v)})}),F(gs,{classes:"order-2 order-md-3","active-octaves":c.value,waveform:h.value,"listened-frequency":o.value,"bad-frequency":l.value,onPressedFrequencies:u[8]||(u[8]=v=>p.value=v)},null,8,["active-octaves","waveform","listened-frequency","bad-frequency"]),F(Js,{class:"order-4","show-american-system":r.value,"show-classic-system":t.value,"is-running":i.value,"listened-frequency":o.value,"bad-frequency":l.value,"listened-note":a.value,"pressed-frequencies":p.value},null,8,["show-american-system","show-classic-system","is-running","listened-frequency","bad-frequency","listened-note","pressed-frequencies"])],64))}});export{tn as default};
